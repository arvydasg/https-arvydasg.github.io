<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<link rel="alternate"
      type="application/rss+xml"
      href="https://arvydasg.github.io/rss.xml"
      title="RSS feed for https://arvydasg.github.io/">
<title>Dired diff-hl</title>
<meta name="author" content="Arvydas Gasparavicius">
<meta name="referrer" content="no-referrer">
<meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1">
<link href= "static/style.css" rel="stylesheet" type="text/css" />
<script src="static/lightbox.js"></script>
<script src="static/auto-render.min.js"></script>
<link rel="icon" href="static/ag.ico"></head>
<body>
<div id="preamble" class="status">
<div id="nav-content">
<div class="header">
   <a href="https://arvydasg.github.io/">Arvydas.dev</a>
  <div class="sitelinks">
    <a href="https://arvydasg.github.io/about.html">About</a> | <a href="https://arvydasg.github.io/freelancing.html">Freelancing</a> | <a href="https://arvydasg.github.io/tag-project.html">Projects</a> | <a href="https://arvydasg.github.io/archive.html">Blog</a> | <a href="https://arvydasg.github.io/uses.html">Uses</a>
  </div>
<hr>
  </div>
</div></div>
<div id="content">
<div class="post-date">19 Jun 2022</div><h1 class="post-title"><a href="https://arvydasg.github.io/2022-06-19-dired-diff-hl.html">Dired diff-hl</a></h1>

<figure id="org8ced3b2">
<img src="./static/images/dired-diff-hl.png" alt="dired-diff-hl.png" width="1200px">

</figure>

<div id="outline-container-org3805963" class="outline-2">
<h2 id="org3805963">Introduction</h2>
<div class="outline-text-2" id="text-org3805963">
<p>
So, everything started when I have discovered ‘diff-hl’ package. It
had an option to show differences in dired buffer. I thought okay,
cool option, lets not use neotree anymore and use dired instead.
</p>
</div>
</div>

<div id="outline-container-org34ce37e" class="outline-2">
<h2 id="org34ce37e">Body</h2>
<div class="outline-text-2" id="text-org34ce37e">
<p>
I added a few lines to ‘diff-hl’ config to make the file changes
visible in dired buffer.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #fe8019;">(</span><span style="color: #fb4934;">use-package</span> <span style="color: #d3869b;">diff-hl</span>
  <span style="color: #fe8019;">:ensure</span> t
  <span style="color: #fe8019;">:init</span> <span style="color: #cc241d;">(</span>add-hook 'prog-mode-hook #'diff-hl-mode<span style="color: #cc241d;">)</span>
  <span style="color: #cc241d;">(</span>add-hook 'org-mode-hook #'diff-hl-mode<span style="color: #cc241d;">)</span>
  <span style="color: #cc241d;">(</span>add-hook 'dired-mode-hook 'diff-hl-dired-mode<span style="color: #cc241d;">)</span>
  <span style="color: #cc241d;">(</span>add-hook 'magit-post-refresh-hook 'diff-hl-magit-post-refresh<span style="color: #cc241d;">)</span>
  <span style="color: #cc241d;">(</span>add-hook 'magit-pre-refresh-hook 'diff-hl-magit-post-refresh<span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
I then watched some videos to remind myself of dired commands and
configs.
</p>

<p>
I saw a guy effortlessly jumping from one directory to another,
opening a file, opening a directory at point, opening another
directory, closing dired buffer with q and not complaining about many
opened buffers after he jumped between a few with dired.
</p>

<p>
First of all, I wanted the same behavior as ‘neotree’. I wanted to see
the current directory and its files with one keystroke. There original
one C-x d ASKS me for a directory. C-x C-d just list a directory -
didn’t understand this function. Then I discovered ‘jump-to-dir’ smth
like that, so I bind that to C-x C-d. Great, I can now open current
directory and see it’s files quickly.
</p>

<p>
Next issues - I could navigate dired buffers with f - forward q -
backwards. BUT if I wanted to quit, I could not do it, because q was
taken already.
</p>

<p>
Then on top of that I have discovered that after navigating through a
few directories, my buffer list gets cluttered with dired buffers of
visited files. That’s definitely a no-go, because I don’t want to
accidentally open dired buffer that is named the same as my file when
I am looking for a file.
</p>

<p>
To fix BOTH of these issues I have discovered
‘dired-find-alternate-file’ command. It is bound to ‘a’ and it opens a
file or directory WITHOUT creating a separate buffer for it. Great!
</p>

<p>
Then it also somehow leaves ‘q’ unused, so I can quit dired buffer
with that keystroke. Great!
</p>

<p>
Then I rebind ‘dired-find-alternate-file’ to ‘f’, because I find it
more convenient to cycle with and I am all set!
</p>
</div>
</div>

<div id="outline-container-orgb23fa71" class="outline-2">
<h2 id="orgb23fa71">The final config</h2>
<div class="outline-text-2" id="text-orgb23fa71">
<div class="org-src-container">
<pre class="src src-emacs-lisp"> <span style="color: #fe8019;">(</span><span style="color: #fb4934;">use-package</span> <span style="color: #d3869b;">dired</span>
    <span style="color: #fe8019;">:ensure</span> nil                         <span style="color: #928374;">;</span><span style="color: #928374;">no need for t, because dired is built in</span>
    <span style="color: #fe8019;">:custom</span> <span style="color: #cc241d;">(</span><span style="color: #b8bb26;">(</span>dired-listing-switches <span style="color: #b8bb26;">"-agho --group-directories-first"</span><span style="color: #b8bb26;">)</span><span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span> <span style="color: #928374;">;</span><span style="color: #928374;">sort directories first</span>
  <span style="color: #fe8019;">(</span>global-set-key <span style="color: #cc241d;">(</span>kbd <span style="color: #b8bb26;">"C-x C-d"</span><span style="color: #cc241d;">)</span> 'dired-jump<span style="color: #fe8019;">)</span> <span style="color: #928374;">;</span><span style="color: #928374;">open dired buffer in current location</span>
  <span style="color: #fe8019;">(</span>define-key dired-mode-map <span style="color: #cc241d;">(</span>kbd <span style="color: #b8bb26;">"f"</span><span style="color: #cc241d;">)</span> 'dired-find-alternate-file<span style="color: #fe8019;">)</span>
<span style="color: #928374;">;; </span><span style="color: #928374;">(global-set-key (kbd "C-x d") 'dired)</span>

  <span style="color: #928374;">;; </span><span style="color: #928374;">a function to kill dired buffers. Kind of works. Or you can use "a"</span>
  <span style="color: #928374;">;; </span><span style="color: #928374;">to cycle through dired and it leaves no buffers opened</span>
  <span style="color: #928374;">;; </span><span style="color: #928374;">DiredReuseDirectoryBuffer - https://www.emacswiki.org/emacs/DiredReuseDirectoryBuffer</span>
  <span style="color: #928374;">;; </span><span style="color: #928374;">KillingBuffers - https://www.emacswiki.org/emacs/KillingBuffers</span>
  <span style="color: #fe8019;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #b8bb26;">kill-dired-buffers</span> <span style="color: #cc241d;">()</span>
    <span style="color: #cc241d;">(</span><span style="color: #fb4934;">interactive</span><span style="color: #cc241d;">)</span>
    <span style="color: #cc241d;">(</span>mapc <span style="color: #b8bb26;">(</span><span style="color: #fb4934;">lambda</span> <span style="color: #83a598;">(</span>buffer<span style="color: #83a598;">)</span>
            <span style="color: #83a598;">(</span><span style="color: #fb4934;">when</span> <span style="color: #8ec07c;">(</span>eq 'dired-mode <span style="color: #83a598;">(</span>buffer-local-value 'major-mode buffer<span style="color: #83a598;">)</span><span style="color: #8ec07c;">)</span>
              <span style="color: #8ec07c;">(</span>kill-buffer buffer<span style="color: #8ec07c;">)</span><span style="color: #83a598;">)</span><span style="color: #b8bb26;">)</span>
          <span style="color: #b8bb26;">(</span>buffer-list<span style="color: #b8bb26;">)</span><span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>

  <span style="color: #928374;">;; </span><span style="color: #928374;">can easily check how many buffers got opened</span>
  <span style="color: #fe8019;">(</span><span style="color: #fb4934;">defun</span> <span style="color: #b8bb26;">kill-all-dired-buffers</span> <span style="color: #cc241d;">()</span>
    <span style="color: #dfd2b8;">"Kill all dired buffers."</span>
    <span style="color: #cc241d;">(</span><span style="color: #fb4934;">interactive</span><span style="color: #cc241d;">)</span>
    <span style="color: #cc241d;">(</span><span style="color: #fb4934;">save-excursion</span>
      <span style="color: #b8bb26;">(</span><span style="color: #fb4934;">let</span> <span style="color: #83a598;">(</span><span style="color: #8ec07c;">(</span>count 0<span style="color: #8ec07c;">)</span><span style="color: #83a598;">)</span>
        <span style="color: #83a598;">(</span><span style="color: #fb4934;">dolist</span> <span style="color: #8ec07c;">(</span>buffer <span style="color: #83a598;">(</span>buffer-list<span style="color: #83a598;">)</span><span style="color: #8ec07c;">)</span>
          <span style="color: #8ec07c;">(</span>set-buffer buffer<span style="color: #8ec07c;">)</span>
          <span style="color: #8ec07c;">(</span><span style="color: #fb4934;">when</span> <span style="color: #83a598;">(</span>equal major-mode 'dired-mode<span style="color: #83a598;">)</span>
            <span style="color: #83a598;">(</span><span style="color: #fb4934;">setq</span> count <span style="color: #cc241d;">(</span>1+ count<span style="color: #cc241d;">)</span><span style="color: #83a598;">)</span>
            <span style="color: #83a598;">(</span>kill-buffer buffer<span style="color: #83a598;">)</span><span style="color: #8ec07c;">)</span><span style="color: #83a598;">)</span>
        <span style="color: #83a598;">(</span>message <span style="color: #b8bb26;">"Killed %i dired buffer(s)."</span> count<span style="color: #83a598;">)</span><span style="color: #b8bb26;">)</span><span style="color: #cc241d;">)</span><span style="color: #fe8019;">)</span>
</pre>
</div>

<p>
Some killing buffers commands are just extras. Was using those when I
was testing out how many opened buffers there were. But luckily I
found ‘dired-find-alternate-file’ :)
</p>
</div>
</div>
<div class="taglist"><a href="https://arvydasg.github.io/tags.html">Tags</a>: <a href="https://arvydasg.github.io/tag-emacs.html">emacs</a> </div></div>
<div id="postamble" class="status"><div id="footer">
<hr>
<p>© 2021-2023 Arvydas Gasparavičius</p>
</div></div>
</body>
</html>
