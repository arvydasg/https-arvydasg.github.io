<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2024-06-05 Wed 12:37 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>First nixos installation</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Arvydas Gasparavicius">
<meta name="description" content="Welcome to my devnotes site"
>
<meta name="keywords" content="emacs django">

<link rel="stylesheet" href="./static/css/org-html-style-default.css" type="text/css"/>
<link rel="stylesheet" href="./static/css/generic.css" type="text/css"/>
<link rel="stylesheet" href="./static/css/taingram.css" type="text/css"/>
<link rel="stylesheet" href="./static/css/lightbox.css" type="text/css"/>
<link rel="stylesheet" href="./static/css/scroll-to-top.css" type="text/css"/>
<link rel="icon" href="./static/ag.ico">
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="sitemap.html">NOTES </a>
 
 <a accesskey="H" href="index.html"> HOME </a>
</div><div id="preamble" class="status">

	 <!-- Had to comment out this, because of the github actions, read in the docs for more detail -->
	 <!-- <div id="updated">Updated: 2024-06-05 Wed 12:37</div> -->
</div>
<div id="content">
<header>
<h1 class="title">First nixos installation</h1>
</header><nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgd580946">1. Why NixOS</a></li>
<li><a href="#orgf374569">2. Why NixOS by others</a></li>
<li><a href="#org3941019">3. Documentation</a></li>
<li><a href="#orgb93f585">4. Installation on WSL</a>
<ul>
<li><a href="#org0c2b8e8">4.1. Check if NixOS is not already installed</a></li>
<li><a href="#org13573a0">4.2. Install</a></li>
</ul>
</li>
<li><a href="#org960bb15">5. Configure NixOS installation over Emacs</a></li>
<li><a href="#orgf697023">6. Authenticate to git</a></li>
<li><a href="#orgf43f41b">7. Clone the dotfiles repo</a></li>
<li><a href="#org95df7f6">8. Using your own custom nixos configuration file</a></li>
<li><a href="#org00620a1">9. Using your own custom Emacs config</a></li>
<li><a href="#org901d5e7">10. GUI glitch</a></li>
</ul>
</div>
</nav>

<div id="outline-container-orgd580946" class="outline-2">
<h2 id="orgd580946"><span class="section-number-2">1</span> Why NixOS</h2>
<div class="outline-text-2" id="text-1">
<p>
AFTER you reinstall your machine - to install the DEV environment, all you
have to take with you is <code>/etc/nixos/configuration.nix</code> file, everything is
described in it. Amazing!
</p>

<p>
When previously you would have to check your notes for step by step
instruction(similar like <a href="20231128T130237--linux-ubuntu-install__linux.html">linux ubuntu install</a>), to configure your new
environment same as it was before, then run different scripts from different
places, make sure you got them all.. with nix you will never have that pain
again.
</p>
</div>
</div>

<div id="outline-container-orgf374569" class="outline-2">
<h2 id="orgf374569"><span class="section-number-2">2</span> Why NixOS by others</h2>
<div class="outline-text-2" id="text-2">
<ul class="org-ul">
<li><a href="https://github.com/hlissner/dotfiles">https://github.com/hlissner/dotfiles</a></li>
<li><a href="https://github.com/terlar/nix-config">https://github.com/terlar/nix-config</a></li>
</ul>
</div>
</div>

<div id="outline-container-org3941019" class="outline-2">
<h2 id="org3941019"><span class="section-number-2">3</span> Documentation</h2>
<div class="outline-text-2" id="text-3">
<ul class="org-ul">
<li>nixos github repo - <a href="https://github.com/nix-community/NixOS-WSL">https://github.com/nix-community/NixOS-WSL</a></li>
<li>nixos manual - <a href="https://nixos.org/manual/nix/stable/">https://nixos.org/manual/nix/stable/</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgb93f585" class="outline-2">
<h2 id="orgb93f585"><span class="section-number-2">4</span> Installation on WSL</h2>
<div class="outline-text-2" id="text-4">
<p>
Steps described here:
</p>

<p>
<a href="https://github.com/nix-community/NixOS-WSL">https://github.com/nix-community/NixOS-WSL</a>
</p>
</div>

<div id="outline-container-org0c2b8e8" class="outline-3">
<h3 id="org0c2b8e8"><span class="section-number-3">4.1</span> Check if NixOS is not already installed</h3>
<div class="outline-text-3" id="text-4-1">
<p>
Run the commands in windows cmd or powershell.
</p>

<div class="org-src-container">
<pre class="src src-bash">wsl --status
wsl --version
wsl --help
wsl --list --verbose
</pre>
</div>
</div>
</div>

<div id="outline-container-org13573a0" class="outline-3">
<h3 id="org13573a0"><span class="section-number-3">4.2</span> Install</h3>
<div class="outline-text-3" id="text-4-2">
<p>
If it does not exist(<code>wsl --list --verbose</code> does not yield result with nixos ),
then basically download <code>nixos-wsl.tar.gz</code> into your windows <code>/Downloads</code>
folder from the <a href="https://github.com/nix-community/NixOS-WSL/releases/tag/2311.5.3">latest release</a>.
</p>

<p>
Then in CMD run(while in /Downloads folder):
</p>
<div class="org-src-container">
<pre class="src src-bash">wsl --import NixOS .\NixOS<span style="font-style: italic;">\ </span>nixos-wsl.tar.gz --version 2
</pre>
</div>

<p>
check if it was really installed:
</p>
<div class="org-src-container">
<pre class="src src-bash">wsl -l -v
</pre>
</div>

<p>
You should see NixOS listed. Now we can run nixos:
</p>
<div class="org-src-container">
<pre class="src src-bash">wsl -d NixOS
</pre>
</div>

<p>
After the initial installation, you need to update your channels once(while in
nixos), to be able to use <code>nixos-rebuild</code>:
</p>
<div class="org-src-container">
<pre class="src src-bash">sudo nix-channel --add https://nixos.org/channels/nixos-23.11 nixos
sudo nix-channel --update
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org960bb15" class="outline-2">
<h2 id="org960bb15"><span class="section-number-2">5</span> Configure NixOS installation over Emacs</h2>
<div class="outline-text-2" id="text-5">
<p>
Enter <code>nix-shell</code> to use Emacs(it does not get installed on the system, just
<a href="https://nix.dev/tutorials/first-steps/ad-hoc-shell-environments">TEMPORARILY</a> FROM NIXOS CACHE?). So I can then modify the configuration
<code>/etc/nixos/configuration.nix</code> file.
</p>

<div class="org-src-container">
<pre class="src src-bash">nix-shell -p emacs29
</pre>
</div>

<p>
Then let's run emacs in nix-shell(run with sudo)
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo emacs
</pre>
</div>

<p>
Ok now you are in Emacs, but in <code>nix-shell</code>. If we turn off nixos now, when we
launch it again, emacs will not be available. Only after you run <code>nix-shell -p
emacs</code>. Let's install emacs permanetely. First open the default NixOS
configuration file:
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo emacs /etc/nixos/configuration.nix
</pre>
</div>

<p>
Add the following 4 files lines, it will install Emacs globally and permanetely
inside of NixOS as well as git(we will need it to clone our config repos). We
Install emacs29 because of <a href="20231125T220943--seq-keep-error-message-in-emacs__emacs_magit.html">seq error message</a> that I have faced before:
</p>

<div class="org-src-container">
<pre class="src src-nix">environment.systemPackages = with pkgs; [
  emacs29
  git
];
</pre>
</div>

<p>
After adding these 4 lines to the config file, <code>C-d</code> to go back to
nixos@nixos(out of nix-shell) and BUILD the nixos with the new changes(emacs
and git installation).
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo nixos-rebuild switch
</pre>
</div>

<p>
After this finishes running, you should be able to use Emacs and git!
</p>

<div class="org-src-container">
<pre class="src src-bash">emacs
git status
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf697023" class="outline-2">
<h2 id="orgf697023"><span class="section-number-2">6</span> Authenticate to git</h2>
<div class="outline-text-2" id="text-6">
<p>
Some of our config repos are private, so for that we need to authenticate to
git first.
</p>

<p>
First you must do <a href="20231211T161252--introduce-yourself-to-git__git.html">this</a>.
</p>

<p>
Then one of these:
</p>

<ul class="org-ul">
<li><a href="20231214T060637--authenticate-to-git-with-personal-access-token__git.html">authenticate with personal access token</a></li>
<li><a href="20231214T060558--authenticate-to-git-with-ssh__git_ssh.html">authenticate with ssh</a>(usually using this at home)</li>

<li>On work machine, set up ssh method to work repo.</li>
<li>On work machine for personal repos - use token method.</li>
</ul>
</div>
</div>

<div id="outline-container-orgf43f41b" class="outline-2">
<h2 id="orgf43f41b"><span class="section-number-2">7</span> Clone the dotfiles repo</h2>
<div class="outline-text-2" id="text-7">
<p>
It consists both emacs and nixos config, we will need both in the next steps.
</p>

<div class="org-src-container">
<pre class="src src-bash">mkdir ~/GIT
<span style="font-weight: bold;">cd</span> ~/GIT
git clone https://github.com/arvydasg/dotfiles
</pre>
</div>
</div>
</div>

<div id="outline-container-org95df7f6" class="outline-2">
<h2 id="org95df7f6"><span class="section-number-2">8</span> Using your own custom nixos configuration file</h2>
<div class="outline-text-2" id="text-8">
<div class="org-src-container">
<pre class="src src-bash"><span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">delete current nixos directory</span>
sudo rm -rf /etc/nixos
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">put our config folder instead of the default one</span>
sudo ln -s ~/GIT/dotfiles/nixos/ /etc/nixos
</pre>
</div>

<p>
Check if the symlink worked:
</p>

<div class="org-src-container">
<pre class="src src-bash">ls -la /etc | grep nixos
</pre>
</div>

<p>
You should see <code>nixos -&gt; /home/nixos/GIT/dotfiles/nixos/</code>.
</p>

<p>
If so, then you are done.
</p>

<p>
We can rebuild NixOS with the settings from our personal configuration in mind.
</p>

<div class="org-src-container">
<pre class="src src-bash">sudo nixos-rebuild switch
</pre>
</div>

<p>
After this is done running, our NixOS installation will be current, as the one
described in the configuration file.
</p>

<blockquote>
<p>
Note on Installing other packages
</p>

<p>
If you want to install a package called "make" for example and nixos says it
can not find it when you attempt to install it, then you can do
<code>command-not-found make</code>, this command will show each package which exposes
that command. Quite useful to know all the versions/types of the package you
want to install.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org00620a1" class="outline-2">
<h2 id="org00620a1"><span class="section-number-2">9</span> Using your own custom Emacs config</h2>
<div class="outline-text-2" id="text-9">
<p>
After we have all the "OS" dependencies installed, we can install Emacs
dependencies.
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">remove .emacs.d dir from ~/ first</span>
<span style="font-weight: bold;">cd</span> ~/GIT
ln -s GIT/dotfiles/.emacs.d/ ~/.emacs.d
</pre>
</div>

<p>
Check if symlink got created with(while in ~/ dir):
</p>

<div class="org-src-container">
<pre class="src src-bash">ls -la | grep .emacs.d
</pre>
</div>

<p>
Should see something like <code>.emacs.d -&gt; GIT/dotfiles/.emacs.d/</code>.
</p>

<p>
Do the following step that is described in the emacs config, tangling part -
<a href="https://github.com/arvydasg/dotfiles/blob/master/.emacs.d/init.org#tangling">here</a>.
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="font-weight: bold;">cd</span> ~/.emacs.d
git update-index --assume-unchanged init.el
</pre>
</div>

<p>
Try to launch emacs for all the packages to be installed.
</p>
</div>
</div>

<div id="outline-container-org901d5e7" class="outline-2">
<h2 id="org901d5e7"><span class="section-number-2">10</span> GUI glitch</h2>
<div class="outline-text-2" id="text-10">
<p>
Reported it here  - <a href="https://github.com/microsoft/wslg/issues/1148">https://github.com/microsoft/wslg/issues/1148</a>
</p>

<p>
Possible fix(questionable) .wslgconfig(as explained in the comments of the issue)
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<hr/>
	 <footer>
	 <p class="date generated">This note is <u>first written</u>: 2023-12-11 Mon 15:14</p>
	 <div class="copyright-container generated">
	 <div class="copyright">
	 Copyright &copy; 2023-2024 Arvydas Gasparavicius
	 </div>
	 </div>
	 <!-- Had to comment out this, because of the github actions, read in the docs for more detail -->
	 <!-- <p class="date">This org file is <u>exported</u> to HTML: 2024-06-05 Wed 12:37</p> -->
	 <!-- <p class="date">This org file is last <u>modified</u>: 2024-06-05 Wed 12:37</p> -->
	 <!-- <p class="date">This org file is <u>created</u>: 2023-12-11 Mon 15:14</p> -->
	 <div class="generated">
	Created with <a href="https://www.gnu.org/software/emacs/">Emacs</a> 27.1 (<a href="https://orgmode.org">Org</a> mode 9.3) on <a href="https://www.gnu.org">GNU</a>/<a href="https://www.kernel.org/">Linux</a>
	</div>
	</footer>
	 <button onclick="topFunction()" id="myBtn" title="Go to top">Top</button>
	 <script src="./static/js/generic.js"></script>
	 <script src="./static/js/scroll-to-top.js"></script>
	 <script src="./static/js/lightbox.js"></script>
	 <script src="./static/js/search.js"></script>
</div>
</body>
</html>
