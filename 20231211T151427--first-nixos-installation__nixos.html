<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2023-12-28 Thu 09:20 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>first nixos installation</title>
<meta name="author" content="Arvydas Gasparavicius" />
<meta name="description" content="welcome to my site" />
<meta name="keywords" content="emacs antanas geles" />
<meta name="generator" content="Org Mode" />

<link rel="stylesheet" href="./static/css/org-html-style-default.css" type="text/css"/>
<link rel="stylesheet" href="./static/css/generic.css" type="text/css"/>
<link rel="stylesheet" href="./static/css/taingram.css" type="text/css"/>
<link rel="stylesheet" href="./static/css/lightbox.css" type="text/css"/>
<link rel="stylesheet" href="./static/css/scroll-to-top.css" type="text/css"/>
<link rel="icon" href="./static/ag.ico">
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="sitemap.html">NOTES </a>
 
 <a accesskey="H" href="index.html"> HOME </a>
</div><div id="preamble" class="status">
<div id="updated">Updated: 2023-12-27 Wed 11:45</div>
</div>
<div id="content" class="content">
<header>
<h1 class="title">first nixos installation</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgd443be0">1. Why NixOS</a></li>
<li><a href="#org86d3812">2. Why NixOS by others</a></li>
<li><a href="#org5b86a2d">3. Documentation</a></li>
<li><a href="#org5286604">4. Installation on WSL</a>
<ul>
<li><a href="#org6bad710">4.1. Check if NixOS is not already installed</a></li>
<li><a href="#org596231c">4.2. Install</a></li>
</ul>
</li>
<li><a href="#orgbd74764">5. Configure the installation over emacs</a></li>
<li><a href="#org8315ead">6. Using your own custom nixos configuration file</a></li>
<li><a href="#org9a0e8b3">7. Install other packages</a></li>
<li><a href="#org42475c5">8. Setting up git</a></li>
</ul>
</div>
</nav>

<div id="outline-container-orgd443be0" class="outline-2">
<h2 id="orgd443be0"><span class="section-number-2">1.</span> Why NixOS</h2>
<div class="outline-text-2" id="text-1">
<p>
AFTER you reinstall your machine - to install the DEV environment, all you
have to take with you is <code>/etc/nixos/configuration.nix</code> file, everything is
described in it. Amazing!
</p>

<p>
When previously you would have to check your notes for step by step
instruction(similar like <a href="20231128T130237--linux-ubuntu-install__linux.html">linux ubuntu install</a>), to configure your new
environment same as it was before, then run different scripts from different
places, make sure you got them all.. with nix you will never have that pain
again.
</p>
</div>
</div>

<div id="outline-container-org86d3812" class="outline-2">
<h2 id="org86d3812"><span class="section-number-2">2.</span> Why NixOS by others</h2>
<div class="outline-text-2" id="text-2">
<ul class="org-ul">
<li><a href="https://github.com/hlissner/dotfiles">https://github.com/hlissner/dotfiles</a></li>
<li><a href="https://github.com/terlar/nix-config">https://github.com/terlar/nix-config</a></li>
</ul>
</div>
</div>

<div id="outline-container-org5b86a2d" class="outline-2">
<h2 id="org5b86a2d"><span class="section-number-2">3.</span> Documentation</h2>
<div class="outline-text-2" id="text-3">
<ul class="org-ul">
<li>nixos github repo - <a href="https://github.com/nix-community/NixOS-WSL">https://github.com/nix-community/NixOS-WSL</a></li>
<li>nixos manual - <a href="https://nixos.org/manual/nix/stable/">https://nixos.org/manual/nix/stable/</a></li>
</ul>
</div>
</div>

<div id="outline-container-org5286604" class="outline-2">
<h2 id="org5286604"><span class="section-number-2">4.</span> Installation on WSL</h2>
<div class="outline-text-2" id="text-4">
<p>
Steps described here:
</p>

<p>
<a href="https://github.com/nix-community/NixOS-WSL">https://github.com/nix-community/NixOS-WSL</a>
</p>
</div>

<div id="outline-container-org6bad710" class="outline-3">
<h3 id="org6bad710"><span class="section-number-3">4.1.</span> Check if NixOS is not already installed</h3>
<div class="outline-text-3" id="text-4-1">
<div class="org-src-container">
<pre class="src src-bash">wsl --status
wsl --version
wsl --help
wsl --list --verbose
</pre>
</div>
</div>
</div>

<div id="outline-container-org596231c" class="outline-3">
<h3 id="org596231c"><span class="section-number-3">4.2.</span> Install</h3>
<div class="outline-text-3" id="text-4-2">
<p>
If it does not exist, then basically download <code>nixos-wsl.tar.gz</code> into your
windows <code>/Downloads</code> folder.
</p>

<p>
Then in CMD run(while in /Downloads folder):
</p>
<div class="org-src-container">
<pre class="src src-bash">wsl --import NixOS .\NixOS\ nixos-wsl.tar.gz --version 2
</pre>
</div>

<p>
check if it was really installed:
</p>
<div class="org-src-container">
<pre class="src src-bash">wsl -l -v
</pre>
</div>

<p>
You should see NixOS listed. Now we can run nixos:
</p>
<div class="org-src-container">
<pre class="src src-bash">wsl -d NixOS
</pre>
</div>

<p>
After the initial installation, you need to update your channels once, to be
able to use <code>nixos-rebuild</code>:
</p>
<div class="org-src-container">
<pre class="src src-bash">sudo nix-channel --add https://nixos.org/channels/nixos-23.11 nixos
sudo nix-channel --update
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgbd74764" class="outline-2">
<h2 id="orgbd74764"><span class="section-number-2">5.</span> Configure the installation over emacs</h2>
<div class="outline-text-2" id="text-5">
<p>
Enter nix-shell to use emacs(it does not get installed on the system, just
<a href="https://nix.dev/tutorials/first-steps/ad-hoc-shell-environments">TEMPORARILY</a> FROM NIXOS CACHE?). So I can then modify the
<code>/etc/nixos/configuration.nix</code> file.
</p>
<div class="org-src-container">
<pre class="src src-bash">nix-shell -p emacs29
</pre>
</div>

<p>
Then let's run emacs in nix-shell(run with sudo)
</p>
<div class="org-src-container">
<pre class="src src-bash">sudo emacs
</pre>
</div>

<p>
Ok now you are in emacs, but in nix-shell. If we turn off nixos now, when we
launch it again, emacs will not be available. Only after you run <code>nix-shell -p
emacs</code>. Let's install emacs permanetely:
</p>
<div class="org-src-container">
<pre class="src src-bash">sudo emacs /etc/nixos/configuration.nix
</pre>
</div>

<p>
add these lines:
</p>
<div class="org-src-container">
<pre class="src src-nix">environment.systemPackages = with pkgs; [
  emacs29
  git
];
</pre>
</div>

<p>
we Install emacs29 because of <a href="20231125T220943--seq-keep-error-message-in-emacs__emacs_magit.html">seq error message</a>.
</p>

<p>
after you do that, <code>C-d</code> to go back to nixos@nixos(out of nix-shell) and BUILD
the nixos with the new changes(emacs installation).
</p>
<div class="org-src-container">
<pre class="src src-bash">sudo nixos-rebuild switch
</pre>
</div>

<p>
After this runs, you should be able to use Emacs and use git!
</p>

<p>
Clone the dotfiles repo:
</p>
<div class="org-src-container">
<pre class="src src-bash">mkdir ~/GIT
cd ~/GIT
git clone https://github.com/arvydasg/dotfiles
ln -s GIT/dotfiles/.emacs.d/ ~/.emacs.d
cd ~/.emacs.d
git update-index --assume-unchanged init.el
</pre>
</div>

<p>
Try to launch emacs for all the packages to be installed.
</p>
</div>
</div>

<div id="outline-container-org8315ead" class="outline-2">
<h2 id="org8315ead"><span class="section-number-2">6.</span> Using your own custom nixos configuration file</h2>
<div class="outline-text-2" id="text-6">
<p>
It suchs to not be able to edit the <code>/etc/nixos/configuration.nix</code> file over
emacs as nixos default user. I want this file to not be owned by root, but bu
nixos user. So what we will do is we will:
</p>

<div class="org-src-container">
<pre class="src src-bash"># delete current nixos directory
sudo rm -rf /etc/nixos
# put our config folder instead of the default one
sudo ln -s ~/GIT/dotfiles/nixos/ /etc/nixos
</pre>
</div>

<p>
You are done. Should be able to edit <code>configuration.nix</code> file now.
</p>
</div>
</div>

<div id="outline-container-org9a0e8b3" class="outline-2">
<h2 id="org9a0e8b3"><span class="section-number-2">7.</span> Install other packages</h2>
<div class="outline-text-2" id="text-7">
<p>
If you want to install a package called "make" for example and nixos says it
can not find it when you attempt to install it, then you can do
<code>command-not-found make</code>, this command will show each package which exposes
that command. Quite useful to know all the versions/types of the package you
want to install.
</p>
</div>
</div>

<div id="outline-container-org42475c5" class="outline-2">
<h2 id="org42475c5"><span class="section-number-2">8.</span> Setting up git</h2>
<div class="outline-text-2" id="text-8">
<p>
First try <a href="20231211T161252--introduce-yourself-to-git__git.html">this</a>, then one of these:
</p>

<ul class="org-ul">
<li><a href="20231214T060637--authenticate-to-git-with-personal-access-token__git.html">authenticate with personal access token</a></li>
<li><a href="20231214T060558--authenticate-to-git-with-ssh__git_ssh.html">authenticate with ssh</a></li>
<li><a href="20231214T061312--authenticate-to-git-with-gpg-key__git_gpg.html">authenticate with gpg</a></li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<hr/>
	 <footer>
	 <div class="copyright-container">
	 <div class="copyright">
	 Copyright &copy; 2023-2023 Arvydas Gasparavicius
	 </div>
	 </div>
	 <p class="date">This org file is <u>exported</u> to HTML: 2023-12-28 Thu 09:20</p>
	 <p class="date">This org file is last <u>modified</u>: 2023-12-27 Wed 11:45</p>
	 <p class="date">This org file is <u>created</u>: 2023-12-11 Mon 15:14</p>
	 <div class="generated">
	Created with <a href="https://www.gnu.org/software/emacs/">Emacs</a> 29.1 (<a href="https://orgmode.org">Org</a> mode 9.6.6) on <a href="https://www.gnu.org">GNU</a>/<a href="https://www.kernel.org/">Linux</a>
	</div>
	</footer>
	 <button onclick="topFunction()" id="myBtn" title="Go to top">Top</button>
	 <script src="./static/js/generic.js"></script>
	 <script src="./static/js/scroll-to-top.js"></script>
	 <script src="./static/js/lightbox.js"></script>
</div>
</body>
</html>