<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2024-06-19 Wed 13:14 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Add a lightbox effect for images in html</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Arvydas Gasparavicius">
<meta name="description" content="Welcome to my devnotes site"
>
<meta name="keywords" content="emacs django">

<link rel="stylesheet" href="./static/css/org-html-style-default.css" type="text/css"/>
<link rel="stylesheet" href="./static/css/generic.css" type="text/css"/>
<link rel="stylesheet" href="./static/css/taingram.css" type="text/css"/>
<link rel="stylesheet" href="./static/css/lightbox.css" type="text/css"/>
<link rel="stylesheet" href="./static/css/scroll-to-top.css" type="text/css"/>
<link rel="icon" href="./static/ag.ico">
</head>
<body>
<div id="org-div-home-and-up">
 <a href="projects.html"> PROJECTS </a>
 <a href="sitemap.html">NOTES </a>
 

<a href="index.html"> HOME </a>
 </div><div id="preamble" class="status">

	 <!-- Had to comment out this, because of the github actions, read in the docs for more detail -->
	 <!-- <div id="updated">Updated: 2024-06-19 Wed 13:13</div> -->
	  <div id="google_translate_element" style="float:right;"></div>
</div>
<div id="content">
<header>
<h1 class="title">Add a lightbox effect for images in html</h1>
</header><nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org29f105d">1. css</a></li>
<li><a href="#org3b5903b">2. js</a></li>
</ul>
</div>
</nav>
<p>
First, just a reference how to add images in .org files - <a href="20231126T003746--images-in-org-files__emacs.html">images in org files</a>.
</p>

<div id="outline-container-org29f105d" class="outline-2">
<h2 id="org29f105d"><span class="section-number-2">1</span> css</h2>
<div class="outline-text-2" id="text-1">
<div class="org-src-container">
<pre class="src src-css"><span style="font-weight: bold;">div.lightbox </span>{
  <span style="font-weight: bold;">display</span>: flex;
  <span style="font-weight: bold;">flex-direction</span>: row;
  <span style="font-weight: bold;">overflow-x</span>: scroll;
  <span style="font-weight: bold;">background-color</span>: <span style="color: #ffffff; background-color: #000000;">black</span>;
  <span style="font-weight: bold;">padding</span>: 1px 5px 1px 5px;
  <span style="font-weight: bold;">box-shadow</span>: 0 0 1px 1px <span style="color: #ffffff; background-color: #000000;">black</span>;
  <span style="font-weight: bold;">scrollbar-color</span>: <span style="color: #ffffff; background-color: #444;">#444</span> <span style="color: #ffffff; background-color: #000000;">black</span>;
  <span style="font-weight: bold;">scrollbar-width</span>: none;
  <span style="font-weight: bold;">width</span>: calc(100vw - 10px);
  <span style="font-weight: bold;">margin-left</span>: calc(50% - 50vw + 5px);
}

<span style="font-weight: bold;">div.lightbox img:not(.lightbox) </span>{
  <span style="font-weight: bold;">flex</span>: 0 0 auto;
  <span style="font-weight: bold;">height</span>: calc(100% - 4px);
  <span style="font-weight: bold;">margin</span>: 2px;
}

<span style="font-weight: bold;">div.lightbox figure:not(.lightbox) </span>{
  <span style="font-weight: bold;">flex</span>: 0 0 auto;
  <span style="font-weight: bold;">height</span>: calc(100% - 4px);
  <span style="font-weight: bold;">margin</span>: 2px;
}

<span style="font-weight: bold;">div.lightbox figure:not(.lightbox) img </span>{
  <span style="font-weight: bold;">height</span>: calc(100% - 16pt);
  <span style="font-weight: bold;">margin</span>: 0;
}

<span style="font-weight: bold;">div.lightbox figure:not(.lightbox) figcaption </span>{
  <span style="font-weight: bold;">font-size</span>: 8pt;
  <span style="font-weight: bold;">color</span>: <span style="color: #000000; background-color: #ffffff;">white</span>;
  <span style="font-weight: bold;">text-align</span>: center;
}

<span style="font-weight: bold;">figure.lightbox </span>{
  <span style="font-weight: bold;">position</span>: fixed;
  <span style="font-weight: bold;">width</span>: 100%;
  <span style="font-weight: bold;">height</span>: 100%;
  <span style="font-weight: bold;">top</span>: 0;
  <span style="font-weight: bold;">left</span>: 0;
  <span style="font-weight: bold;">background-color</span>: <span style="color: #ffffff; background-color: #000000;">rgba(0, 0, 0, 0.8)</span>;
  <span style="font-weight: bold;">margin</span>: 0;
  <span style="font-weight: bold;">overflow</span>: hidden;
}

<span style="font-weight: bold;">figure.lightbox img.lightbox </span>{
  <span style="font-weight: bold;">position</span>: absolute;
}
<span style="font-weight: bold;">a figure.lightbox figcaption </span>{
  <span style="font-weight: bold;">max-width</span>: 90%;
  <span style="font-weight: bold;">position</span>: absolute;
  <span style="font-weight: bold;">left</span>: 50%;
  <span style="font-weight: bold;">transform</span>: translate(-50%, 0);
  <span style="font-weight: bold;">bottom</span>: 5px;
  <span style="font-weight: bold;">color</span>: <span style="color: #000000; background-color: #ffffff;">white</span>;
  <span style="font-weight: bold;">text-shadow</span>: <span style="color: #ffffff; background-color: #000000;">black</span> 0 0 10px;
}

</pre>
</div>
</div>
</div>

<div id="outline-container-org3b5903b" class="outline-2">
<h2 id="org3b5903b"><span class="section-number-2">2</span> js</h2>
<div class="outline-text-2" id="text-2">
<div class="org-src-container">
<pre class="src src-js"><span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">copied from arvydasg.github.io/static/lightbox.js</span>

<span style="font-weight: bold;">let</span> <span style="font-weight: bold; font-style: italic;">isDragging</span> = <span style="font-weight: bold; text-decoration: underline;">false</span>;
<span style="font-weight: bold;">let</span> <span style="font-weight: bold; font-style: italic;">wasDragged</span> = <span style="font-weight: bold; text-decoration: underline;">false</span>;
<span style="font-weight: bold;">let</span> <span style="font-weight: bold; font-style: italic;">touchCoordinate</span> = [];
<span style="font-weight: bold;">let</span> <span style="font-weight: bold; font-style: italic;">lightboxTime</span> = <span style="font-weight: bold; text-decoration: underline;">undefined</span>;


document.addEventListener(<span style="font-style: italic;">'keyup'</span>, e =&gt; {
    <span style="font-weight: bold;">let</span> <span style="font-weight: bold; font-style: italic;">lightboxImage</span> = document.querySelector(<span style="font-style: italic;">'figure.lightbox img.lightbox'</span>);
    <span style="font-weight: bold;">if</span> (e.key === <span style="font-style: italic;">'Escape'</span> &amp;&amp; lightboxImage) {
        <span style="font-weight: bold;">let</span> <span style="font-weight: bold; font-style: italic;">figure</span> = lightboxImage.parentNode;
        exitLightbox(figure, lightboxImage);
    }
});

<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">openLightbox</span>(<span style="font-weight: bold; font-style: italic;">event</span>) {
    <span style="font-weight: bold;">if</span> (event.buttons !== 0) {
        <span style="font-weight: bold;">return</span>;
    }

    <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">if the browser issues both click and touch events, ignore</span>
    <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">the later one:</span>
    <span style="font-weight: bold;">if</span> (event.timeStamp - lightboxTime &lt; 100) {
        <span style="font-weight: bold;">return</span>;
    }
    lightboxTime = event.timeStamp;

    <span style="font-weight: bold;">let</span> <span style="font-weight: bold; font-style: italic;">image</span> = event.target;
    <span style="font-weight: bold;">let</span> <span style="font-weight: bold; font-style: italic;">figure</span> = image.parentNode;
    <span style="font-weight: bold;">if</span> (wasDragged === <span style="font-weight: bold; text-decoration: underline;">true</span>) {
        wasDragged = <span style="font-weight: bold; text-decoration: underline;">false</span>;
    } <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (figure.classList.contains(<span style="font-style: italic;">'lightbox'</span>)) {
        exitLightbox(figure, image);
    } <span style="font-weight: bold;">else</span> {
        enterLightbox(figure, image);
    }
}

<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">enterLightbox</span>(<span style="font-weight: bold; font-style: italic;">figure</span>, <span style="font-weight: bold; font-style: italic;">image</span>) {
    <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">fix body in place so it doesn't scroll when the lightbox is</span>
    <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">moved by touch</span>
    document.body.style[<span style="font-style: italic;">'top'</span>] = <span style="font-style: italic;">`${-window.scrollY}px`</span>;
    document.body.style[<span style="font-style: italic;">'width'</span>] = <span style="font-style: italic;">`${window.innerWidth}px`</span>;
    document.body.style[<span style="font-style: italic;">'position'</span>] = <span style="font-style: italic;">'fixed'</span>;
    <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">add fake figure as a placeholder while lightbox is showing to</span>
    <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">prevent relayout</span>
    <span style="font-weight: bold;">let</span> <span style="font-weight: bold; font-style: italic;">fakeFig</span> = document.createElement(<span style="font-style: italic;">'figure'</span>);
    fakeFig.id = <span style="font-style: italic;">'fakefig'</span>;
    fakeFig.style[<span style="font-style: italic;">'width'</span>] = <span style="font-style: italic;">`${figure.offsetWidth}px`</span>;
    fakeFig.style[<span style="font-style: italic;">'height'</span>] = <span style="font-style: italic;">`${figure.offsetHeight}px`</span>;
    fakeFig.style[<span style="font-style: italic;">'background-color'</span>] = <span style="font-style: italic;">'#f0f0f0'</span>;
    figure.parentNode.insertBefore(fakeFig, figure);
    <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">activate lightbox</span>
    figure.classList.add(<span style="font-style: italic;">'lightbox'</span>);
    image.classList.add(<span style="font-style: italic;">'lightbox'</span>);
    image.onwheel = zoomLightbox;
    image.style[<span style="font-style: italic;">'max-width'</span>] = <span style="font-style: italic;">'90%'</span>;
    image.style[<span style="font-style: italic;">'max-height'</span>] = <span style="font-style: italic;">'90%'</span>;
    image.addEventListener(<span style="font-style: italic;">'mousedown'</span>, lightboxMouseDown);
    image.addEventListener(<span style="font-style: italic;">'mousemove'</span>, lightboxMouseMove);
    image.addEventListener(<span style="font-style: italic;">'mouseup'</span>, lightboxMouseUp);
    image.setAttribute(<span style="font-style: italic;">'draggable'</span>, <span style="font-weight: bold; text-decoration: underline;">false</span>);
    <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">replace thumbnail with full-resolution image (if necessary):</span>
    <span style="font-weight: bold;">if</span> (image.src.includes(<span style="font-style: italic;">'thumb'</span>)) {
        image.src = image.src.replace(<span style="font-style: italic;">'thumb.'</span>, <span style="font-style: italic;">''</span>);
        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">reposition to center once image is loaded (it will move</span>
        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">because its size changes)</span>
        image.onload = e =&gt; {
            image.style[<span style="font-style: italic;">'left'</span>] = <span style="font-style: italic;">`${(window.innerWidth-image.offsetWidth)/2}px`</span>;
            image.style[<span style="font-style: italic;">'top'</span>] = <span style="font-style: italic;">`${(window.innerHeight-image.offsetHeight)/2}px`</span>;
            image.onload = <span style="font-weight: bold; text-decoration: underline;">undefined</span>;
        }
    }
    <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">set initial image position to center:</span>
    image.style[<span style="font-style: italic;">'left'</span>] = <span style="font-style: italic;">`${(window.innerWidth-image.offsetWidth)/2}px`</span>;
    image.style[<span style="font-style: italic;">'top'</span>] = <span style="font-style: italic;">`${(window.innerHeight-image.offsetHeight)/2}px`</span>;
    <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">hide all other images in this figure:</span>
    <span style="font-weight: bold;">for</span> (<span style="font-weight: bold;">let</span> <span style="font-weight: bold; font-style: italic;">otherImage</span> of figure.querySelectorAll(<span style="font-style: italic;">'img:not(.lightbox)'</span>)) {
        otherImage.style[<span style="font-style: italic;">'visibility'</span>] = <span style="font-style: italic;">'hidden'</span>;
    }
}

<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">exitLightbox</span>(<span style="font-weight: bold; font-style: italic;">figure</span>, <span style="font-weight: bold; font-style: italic;">image</span>) {
    <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">release body</span>
    <span style="font-weight: bold;">let</span> <span style="font-weight: bold; font-style: italic;">scrollY</span> = parseInt(document.body.style[<span style="font-style: italic;">'top'</span>]);
    document.body.style[<span style="font-style: italic;">'top'</span>] = <span style="font-style: italic;">''</span>;
    document.body.style[<span style="font-style: italic;">'position'</span>] = <span style="font-style: italic;">''</span>;
    document.body.style[<span style="font-style: italic;">'width'</span>] = <span style="font-style: italic;">''</span>;
    window.scrollTo(0, -scrollY);
    <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">remove fake figure</span>
    <span style="font-weight: bold;">let</span> <span style="font-weight: bold; font-style: italic;">fakeFig</span> = document.getElementById(<span style="font-style: italic;">'fakefig'</span>);
    fakeFig.remove();
    <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">disable lightbox</span>
    figure.classList.remove(<span style="font-style: italic;">'lightbox'</span>);
    image.classList.remove(<span style="font-style: italic;">'lightbox'</span>);
    image.onwheel = <span style="font-weight: bold; text-decoration: underline;">undefined</span>;
    image.style[<span style="font-style: italic;">'max-width'</span>] = <span style="font-style: italic;">''</span>;
    image.style[<span style="font-style: italic;">'max-height'</span>] = <span style="font-style: italic;">''</span>;
    image.style[<span style="font-style: italic;">'top'</span>] = <span style="font-style: italic;">''</span>;
    image.style[<span style="font-style: italic;">'left'</span>] = <span style="font-style: italic;">''</span>;
    image.removeEventListener(<span style="font-style: italic;">'mousedown'</span>, lightboxMouseDown);
    image.removeEventListener(<span style="font-style: italic;">'mousemove'</span>, lightboxMouseMove);
    image.removeEventListener(<span style="font-style: italic;">'mouseup'</span>, lightboxMouseUp);
    image.setAttribute(<span style="font-style: italic;">'draggable'</span>, <span style="font-weight: bold; text-decoration: underline;">true</span>);
    <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">unhide all images in this figure:</span>
    <span style="font-weight: bold;">for</span> (<span style="font-weight: bold;">let</span> <span style="font-weight: bold; font-style: italic;">otherImage</span> of figure.querySelectorAll(<span style="font-style: italic;">'img'</span>)) {
        otherImage.style[<span style="font-style: italic;">'visibility'</span>] = <span style="font-style: italic;">''</span>;
    }
}

<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">lightboxMouseDown</span>(<span style="font-weight: bold; font-style: italic;">event</span>) {
    isDragging = <span style="font-weight: bold; text-decoration: underline;">true</span>;
}

<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">lightboxMouseMove</span>(<span style="font-weight: bold; font-style: italic;">event</span>) {
    <span style="font-weight: bold;">if</span> (isDragging === <span style="font-weight: bold; text-decoration: underline;">true</span>) {
        <span style="font-weight: bold;">let</span> <span style="font-weight: bold; font-style: italic;">image</span> = event.target;
        image.style[<span style="font-style: italic;">'left'</span>] = <span style="font-style: italic;">`${image.offsetLeft + event.movementX}px`</span>;
        image.style[<span style="font-style: italic;">'top'</span>] = <span style="font-style: italic;">`${image.offsetTop + event.movementY}px`</span>;
        moveImageIntoBorders(image);
        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">prevent closing of figure:</span>
        <span style="font-weight: bold;">if</span> (event.movementX != 0 || event.movementY != 0) {
            wasDragged = <span style="font-weight: bold; text-decoration: underline;">true</span>;
        }
    }
}

<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">lightboxMouseUp</span>(<span style="font-weight: bold; font-style: italic;">event</span>) {
    isDragging = <span style="font-weight: bold; text-decoration: underline;">false</span>;
}

<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">zoomLightbox</span>(<span style="font-weight: bold; font-style: italic;">event</span>) {
    <span style="font-weight: bold;">let</span> <span style="font-weight: bold; font-style: italic;">image</span> = event.target; <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">relative position on image:</span>
    <span style="font-weight: bold;">let</span> <span style="font-weight: bold; font-style: italic;">imageRect</span> = image.getBoundingClientRect();
    <span style="font-weight: bold;">let</span> <span style="font-weight: bold; font-style: italic;">imageX</span> = (event.clientX-imageRect.left)/imageRect.width;
    <span style="font-weight: bold;">let</span> <span style="font-weight: bold; font-style: italic;">imageY</span> = (event.clientY-imageRect.top)/imageRect.height;

    <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">zoom in:</span>
    <span style="font-weight: bold;">let</span> <span style="font-weight: bold; font-style: italic;">zoomFactor</span> = imageRect.width / window.innerWidth;
    zoomFactor /= 1.0 - event.wheelDeltaY / 360;
    zoomFactor = Math.min(Math.max(zoomFactor, 0.9), 5);
    image.style[<span style="font-style: italic;">'max-width'</span>] = <span style="font-style: italic;">`${zoomFactor*100}%`</span>;
    image.style[<span style="font-style: italic;">'max-height'</span>] = <span style="font-style: italic;">`${zoomFactor*100}%`</span>;

    <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">pan so the image does not move under cursor:</span>
    <span style="font-weight: bold;">let</span> <span style="font-weight: bold; font-style: italic;">newPositionX</span> = -imageX*image.offsetWidth + event.clientX;
    <span style="font-weight: bold;">let</span> <span style="font-weight: bold; font-style: italic;">newPositionY</span> = -imageY*image.offsetHeight + event.clientY;
    image.style[<span style="font-style: italic;">'left'</span>] = <span style="font-style: italic;">`${newPositionX}px`</span>;
    image.style[<span style="font-style: italic;">'top'</span>] = <span style="font-style: italic;">`${newPositionY}px`</span>;

    moveImageIntoBorders(image);

    <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">do not scroll background</span>
    event.preventDefault();
}

<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">moveImageIntoBorders</span>(<span style="font-weight: bold; font-style: italic;">image</span>) {
    <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">make sure the image stays within the viewport borders:</span>
    imageRect = image.getBoundingClientRect(); <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">refresh to new coordinates</span>
    <span style="font-weight: bold;">if</span> (imageRect.width &lt;= window.innerWidth*0.9) {
        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">image fits into figure: prevent edges from leaving figure</span>
        <span style="font-weight: bold;">if</span> (imageRect.left &lt; window.innerWidth*0.05) {
            image.style[<span style="font-style: italic;">'left'</span>] = <span style="font-style: italic;">`${window.innerWidth*0.05}px`</span>;
        } <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (imageRect.right &gt; window.innerWidth*0.95) {
            image.style[<span style="font-style: italic;">'left'</span>] = <span style="font-style: italic;">`${window.innerWidth*0.95-imageRect.width}px`</span>;
        }
    } <span style="font-weight: bold;">else</span> {
        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">image too big for figure: prevent edges from entering figure</span>
        <span style="font-weight: bold;">if</span> (imageRect.left &gt; window.innerWidth*0.05) {
            image.style[<span style="font-style: italic;">'left'</span>] = <span style="font-style: italic;">`${window.innerWidth*0.05}px`</span>;
        } <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (imageRect.right &lt; window.innerWidth*0.95) {
            image.style[<span style="font-style: italic;">'left'</span>] = <span style="font-style: italic;">`${window.innerWidth*0.95-imageRect.width}px`</span>;
        }
    }
    <span style="font-weight: bold;">if</span> (imageRect.height &lt;= window.innerHeight*0.9) {
        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">image fits into figure: prevent edges from leaving figure</span>
        <span style="font-weight: bold;">if</span> (imageRect.top &lt; window.innerHeight*0.05) {
            image.style[<span style="font-style: italic;">'top'</span>] = <span style="font-style: italic;">`${window.innerHeight*0.05}px`</span>;
        } <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (imageRect.bottom &gt; window.innerHeight*0.95) {
            image.style[<span style="font-style: italic;">'top'</span>] = <span style="font-style: italic;">`${window.innerHeight*0.95-imageRect.height}px`</span>;
        }
    } <span style="font-weight: bold;">else</span> {
        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">image too big for figure: prevent edges from entering figure</span>
        <span style="font-weight: bold;">if</span> (imageRect.top &gt; window.innerHeight*0.05 ) {
            image.style[<span style="font-style: italic;">'top'</span>] = <span style="font-style: italic;">`${window.innerHeight*0.05}px`</span>;
        } <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (imageRect.bottom &lt; window.innerHeight*0.95) {
            image.style[<span style="font-style: italic;">'top'</span>] = <span style="font-style: italic;">`${window.innerHeight*0.95-imageRect.height}px`</span>;
        }
    }
}


<span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">these function implements a poor-man's 'onclick' for touch events:</span>
<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">handleTouchStart</span>(<span style="font-weight: bold; font-style: italic;">event</span>) {
    <span style="font-weight: bold;">if</span> (event.touches.length == 1 &amp;&amp; touchCoordinate.length == 0) {
        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">remember where the touch started:</span>
        touchCoordinate = [event.touches[0].screenX, event.touches[0].screenY];
    }
}

<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">handleTouchMove</span>(<span style="font-weight: bold; font-style: italic;">event</span>) {
    <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">if the cursor moves too much during the touch, it's not a click:</span>
    <span style="font-weight: bold;">if</span> (event.touches.length == 1 &amp;&amp; touchCoordinate.length == 2) {
        <span style="font-weight: bold;">if</span> ((Math.abs(event.touches[0].screenX - touchCoordinate[0]) &gt; 10) ||
            (Math.abs(event.touches[0].screenY - touchCoordinate[1]) &gt; 10)) {
            touchCoordinate = [];
        }
        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">if more than one finger touches the screen, it's not a click:</span>
    } <span style="font-weight: bold;">else</span> <span style="font-weight: bold;">if</span> (event.touches.length != 1) {
        touchCoordinate = [];
    }
}

<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">handleTouchEnd</span>(<span style="font-weight: bold; font-style: italic;">event</span>) {
    <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">if touchCoordinate still exists at touch end, it's a click:</span>
    <span style="font-weight: bold;">if</span> (touchCoordinate.length == 2) {
        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">if the browser issues both click and touch events, ignore</span>
        <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">the later one:</span>
        <span style="font-weight: bold;">if</span> (event.timeStamp - lightboxTime &lt; 100) {
            <span style="font-weight: bold;">return</span>;
        }
        lightboxTime = event.timeStamp;

        <span style="font-weight: bold;">let</span> <span style="font-weight: bold; font-style: italic;">image</span> = event.target;
        <span style="font-weight: bold;">let</span> <span style="font-weight: bold; font-style: italic;">figure</span> = image.parentNode;
        <span style="font-weight: bold;">if</span> (figure.classList.contains(<span style="font-style: italic;">'lightbox'</span>)) {
            exitLightbox(figure, image);
        } <span style="font-weight: bold;">else</span> {
            enterLightbox(figure, image);
        }
        touchCoordinate = [];
    }
}

<span style="font-weight: bold;">function</span> <span style="font-weight: bold;">handleTouchCancel</span>(<span style="font-weight: bold; font-style: italic;">event</span>) {
    <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">if the touch is cancelled, it's not a click:</span>
    touchCoordinate = [];
}

window.addEventListener(<span style="font-style: italic;">'DOMContentLoaded'</span>, (event) =&gt; {
    <span style="font-weight: bold;">var</span> <span style="font-weight: bold; font-style: italic;">figures</span> = document.getElementsByTagName(<span style="font-style: italic;">'figure'</span>);
    <span style="font-weight: bold;">for</span> (<span style="font-weight: bold;">let</span> <span style="font-weight: bold; font-style: italic;">figure</span> of figures) {
        <span style="font-weight: bold;">let</span> <span style="font-weight: bold; font-style: italic;">images</span> = figure.querySelectorAll(<span style="font-style: italic;">'img'</span>);
        <span style="font-weight: bold;">for</span> (<span style="font-weight: bold;">let</span> <span style="font-weight: bold; font-style: italic;">image</span> of images) {
            image.onclick = openLightbox;
            <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">This is a workaround for image.ontap = opanLightbox:</span>
            image.addEventListener(<span style="font-style: italic;">"touchstart"</span>, handleTouchStart);
            image.addEventListener(<span style="font-style: italic;">"touchend"</span>, handleTouchEnd);
            image.addEventListener(<span style="font-style: italic;">"touchmove"</span>, handleTouchMove);
            image.addEventListener(<span style="font-style: italic;">"touchcancel"</span>, handleTouchCancel);
        }
    }});
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<hr/>
	 <footer>
	 <p class="date generated">This note is <u>first written</u>: 2023-12-19 Tue 09:17</p>
	 <div class="copyright-container generated">
	 <div class="copyright">
	 Copyright &copy; 2023-2024 Arvydas Gasparavicius
	 </div>
	 </div>
	 <!-- Had to comment out this, because of the github actions, read in the docs for more detail -->
	 <!-- <p class="date">This org file is <u>exported</u> to HTML: 2024-06-19 Wed 13:14</p> -->
	 <!-- <p class="date">This org file is last <u>modified</u>: 2024-06-19 Wed 13:13</p> -->
	 <!-- <p class="date">This org file is <u>created</u>: 2023-12-19 Tue 09:17</p> -->
	 <div class="generated">
	Created with <a href="https://www.gnu.org/software/emacs/">Emacs</a> 27.1 (<a href="https://orgmode.org">Org</a> mode 9.3) on <a href="https://www.gnu.org">GNU</a>/<a href="https://www.kernel.org/">Linux</a>
	</div>
	</footer>
	 <button onclick="topFunction()" id="myBtn" title="Go to top">Top</button>
	 <script src="./static/js/generic.js"></script>
	 <script src="./static/js/scroll-to-top.js"></script>
	 <script src="./static/js/lightbox.js"></script>
	 <script src="./static/js/search.js"></script>
	 <script src="./static/js/google-translate.js"></script>
</div>
</body>
</html>
