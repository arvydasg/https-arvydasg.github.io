<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2024-06-02 Sun 21:50 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Building django_starter application step by step</title>
<meta name="author" content="Arvydas Gasparavicius" />
<meta name="description" content="Welcome to my devnotes site" />
<meta name="keywords" content="emacs django" />
<meta name="generator" content="Org Mode" />

<link rel="stylesheet" href="./static/css/org-html-style-default.css" type="text/css"/>
<link rel="stylesheet" href="./static/css/generic.css" type="text/css"/>
<link rel="stylesheet" href="./static/css/taingram.css" type="text/css"/>
<link rel="stylesheet" href="./static/css/lightbox.css" type="text/css"/>
<link rel="stylesheet" href="./static/css/scroll-to-top.css" type="text/css"/>
<link rel="icon" href="./static/ag.ico">
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="sitemap.html">NOTES </a>
 
 <a accesskey="H" href="index.html"> HOME </a>
</div><div id="preamble" class="status">
<div id="updated">Updated: 2024-05-31 Fri 13:31</div>
</div>
<div id="content" class="content">
<header>
<h1 class="title">Building django_starter application step by step</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orga900a37">1. Introduction</a></li>
<li><a href="#org0c2b1fc">2. Set up virtual environment</a></li>
<li><a href="#orged9c58c">3. Create a base project</a>
<ul>
<li><a href="#orge817c8d">3.1. Start a Django project</a></li>
<li><a href="#org76017e8">3.2. Create a basic view in <code>views.py</code></a></li>
<li><a href="#orgf1cf716">3.3. Update <code>urls.py</code></a></li>
<li><a href="#orgd4c0923">3.4. Set up templates in <code>settings.py</code></a></li>
<li><a href="#org063b764">3.5. Create an <code>index.html</code> for the project</a></li>
<li><a href="#org69a4f47">3.6. Run the project for the first time</a></li>
<li><a href="#org041b4cc">3.7. Create a <code>base.html</code> template for nav and footer</a></li>
<li><a href="#org6dc0965">3.8. Add MISC items (Add css, js, images, debug toolbar)</a>
<ul>
<li><a href="#org53ae605">3.8.1. Add css</a></li>
<li><a href="#org9b360ec">3.8.2. Add js</a></li>
<li><a href="#orgba000a1">3.8.3. Add images</a></li>
</ul>
</li>
<li><a href="#org7e4f2ab">3.9. Add bootstrap styling</a></li>
<li><a href="#org115c6ab">3.10. HTML templates for error messages</a></li>
<li><a href="#org7f1dc9f">3.11. Environment variables</a></li>
</ul>
</li>
<li><a href="#orgf672b4d">4. Authentication</a>
<ul>
<li><a href="#org2c439eb">4.1. Django allauth</a>
<ul>
<li><a href="#orgd7d4b7f">4.1.1. Installation</a></li>
</ul>
</li>
<li><a href="#orgf1eda73">4.2. Style allauth templates, Implement crispy forms</a></li>
<li><a href="#orgc8176e1">4.3. Create a user dashboard</a></li>
<li><a href="#orgfe781bb">4.4. Enable social login with Google</a>
<ul>
<li><a href="#orgcbc9196">4.4.1. Add social application in django-admin</a></li>
<li><a href="#orge9820ea">4.4.2. Attempt to register</a></li>
<li><a href="#org9a997c6">4.4.3. Modify the templates to accommodate third party buttons</a></li>
<li><a href="#org699a8c8">4.4.4. Signals</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org7d8f09c">5. Nice to haves</a>
<ul>
<li><a href="#org4c8b144">5.1. Set up Makefile</a></li>
<li><a href="#org9fc8877">5.2. Django-debug-toolbar</a></li>
<li><a href="#orga1b72f7">5.3. Basic tests</a></li>
<li><a href="#orgfc577d7">5.4. Github actions</a></li>
<li><a href="#org530511b">5.5. Black formatter</a></li>
<li><a href="#org4664687">5.6. For security reasons, rename /admin to something else</a></li>
</ul>
</li>
<li><a href="#org31e902f">6. Other TODO's</a>
<ul>
<li><a href="#org37433a8">6.1. <span class="todo TODO">TODO</span> Improve the project</a>
<ul>
<li><a href="#org953a08a">6.1.1. add messages support</a></li>
<li><a href="#orgc5077b6">6.1.2. Images for production</a></li>
</ul>
</li>
<li><a href="#org6639598">6.2. <span class="todo TODO">TODO</span> Pro Django tutorials by thenewboston</a></li>
<li><a href="#org40e2441">6.3. <span class="todo TODO">TODO</span> CRUD functionality with HTMX</a></li>
<li><a href="#orga376b5d">6.4. <span class="todo TODO">TODO</span> Dockerfile (in the far future)</a></li>
<li><a href="#orgc605ae6">6.5. <span class="todo TODO">TODO</span> check health</a></li>
<li><a href="#orgdec9e88">6.6. <span class="todo TODO">TODO</span> Run as docker image, create an image for it.</a></li>
<li><a href="#orgd378a5d">6.7. <span class="todo TODO">TODO</span> add management commands, create some dummy data maybe?</a></li>
<li><a href="#orgb6f24bf">6.8. <span class="todo TODO">TODO</span> create the clean migrations script</a></li>
</ul>
</li>
</ul>
</div>
</nav>

<div id="outline-container-orga900a37" class="outline-2">
<h2 id="orga900a37"><span class="section-number-2">1.</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
This is a Django app that I use at the beginning of every new Django project.
</p>
</div>
</div>

<div id="outline-container-org0c2b1fc" class="outline-2">
<h2 id="org0c2b1fc"><span class="section-number-2">2.</span> Set up virtual environment</h2>
<div class="outline-text-2" id="text-2">
<p>
On windows, we will user virtualenvwrapper -
<a href="https://virtualenvwrapper.readthedocs.io/en/latest/command_ref.html">https://virtualenvwrapper.readthedocs.io/en/latest/command_ref.html</a>
</p>

<div class="org-src-container">
<pre class="src src-bash">pip install virtualenvwrapper
mkvirtualenv venv
lsvirtualenv
workon venv
pip install django
pip freeze &gt; requirements.txt
</pre>
</div>
</div>
</div>

<div id="outline-container-orged9c58c" class="outline-2">
<h2 id="orged9c58c"><span class="section-number-2">3.</span> Create a base project</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-orge817c8d" class="outline-3">
<h3 id="orge817c8d"><span class="section-number-3">3.1.</span> Start a Django project</h3>
<div class="outline-text-3" id="text-3-1">
<div class="org-src-container">
<pre class="src src-bash">django-admin startproject project .
python manage.py runserver
</pre>
</div>

<blockquote>
<p>
We will not create and run migrations until the later point (because we will
create a custom user model).
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org76017e8" class="outline-3">
<h3 id="org76017e8"><span class="section-number-3">3.2.</span> Create a basic view in <code>views.py</code></h3>
<div class="outline-text-3" id="text-3-2">
<p>
Create a <code>views.py</code> in project folder and add this content:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold;">from</span> django.shortcuts <span style="font-weight: bold;">import</span> render
<span style="font-weight: bold;">from</span> django.views <span style="font-weight: bold;">import</span> View
<span style="font-weight: bold;">from</span> django.http <span style="font-weight: bold;">import</span> HttpResponse

<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">Index</span>(View):
    <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">get</span>(<span style="font-weight: bold;">self</span>, request):
        <span style="font-weight: bold;">return</span> render(request, <span style="font-style: italic;">"project/index.html"</span>)

<span style="font-weight: bold;">def</span> <span style="font-weight: bold;">test</span>(request):
    <span style="font-weight: bold;">return</span> HttpResponse(<span style="font-style: italic;">'&lt;h2&gt;Test&lt;/h2&gt;'</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf1cf716" class="outline-3">
<h3 id="orgf1cf716"><span class="section-number-3">3.3.</span> Update <code>urls.py</code></h3>
<div class="outline-text-3" id="text-3-3">
<p>
Create <code>urls.py</code> in project folder and add this content:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold;">from</span> django.contrib <span style="font-weight: bold;">import</span> admin
<span style="font-weight: bold;">from</span> django.urls <span style="font-weight: bold;">import</span> include, path

<span style="font-weight: bold;">from</span> project.views <span style="font-weight: bold;">import</span> Index, test <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">new</span>

<span style="font-weight: bold; font-style: italic;">urlpatterns</span> = [
    path(<span style="font-style: italic;">"admin/"</span>, admin.site.urls),
    path(<span style="font-style: italic;">"accounts/"</span>, include(<span style="font-style: italic;">"django.contrib.auth.urls"</span>)),
    path(<span style="font-style: italic;">""</span>, Index.as_view(), name=<span style="font-style: italic;">"index"</span>), <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">new</span>
    path(<span style="font-style: italic;">'test/'</span>, test, name=<span style="font-style: italic;">"test"</span>), <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">test</span>
]
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd4c0923" class="outline-3">
<h3 id="orgd4c0923"><span class="section-number-3">3.4.</span> Set up templates in <code>settings.py</code></h3>
<div class="outline-text-3" id="text-3-4">
<p>
For django to be able to find our html files, let's tell django about their
location in <code>settings.py</code>, make a modification to the TEMPLATES variable:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="font-style: italic;">"DIRS"</span>: [os.path.join(BASE_DIR, <span style="font-style: italic;">"templates"</span>)],
</pre>
</div>
</div>
</div>

<div id="outline-container-org063b764" class="outline-3">
<h3 id="org063b764"><span class="section-number-3">3.5.</span> Create an <code>index.html</code> for the project</h3>
<div class="outline-text-3" id="text-3-5">
<p>
To be able to display the <code>index.html we have just defined in =views.py</code>
created, we need to set up the templates correctly.
</p>

<p>
Go ahead and create <code>index.html</code> inside of the <code>templates/project</code> directory,
the content of it:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="font-weight: bold;">p</span>&gt;Welcome to index.html&lt;/<span style="font-weight: bold;">p</span>&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-org69a4f47" class="outline-3">
<h3 id="org69a4f47"><span class="section-number-3">3.6.</span> Run the project for the first time</h3>
<div class="outline-text-3" id="text-3-6">
<p>
Do a <code>python manage.py runserver</code> now and you will be presented with the index
page with <b><b>Welcome to index.html</b></b> displayed in it.
</p>

<p>
When visiting /test, you should see the test view. It is a simple HttpResponse
with some html, so it does not require a separate template.
</p>
</div>
</div>

<div id="outline-container-org041b4cc" class="outline-3">
<h3 id="org041b4cc"><span class="section-number-3">3.7.</span> Create a <code>base.html</code> template for nav and footer</h3>
<div class="outline-text-3" id="text-3-7">
<p>
We want to display some sort of navigation and footer on ALL pages in our site.
</p>

<p>
Instead of modifying each template and adding those things, we can specify it
in one place and tell django to put that single piece of template into each
django .html page.
</p>

<p>
Inside of the <code>templates</code> folder, create <code>base</code> folder and then <code>base.html</code> in
it with such content:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="font-weight: bold;">!DOCTYPE</span> html&gt;
&lt;<span style="font-weight: bold;">html</span> <span style="font-weight: bold; font-style: italic;">lang</span>=<span style="font-style: italic;">"en"</span>&gt;
  &lt;<span style="font-weight: bold;">head</span>&gt;
    &lt;<span style="font-weight: bold;">meta</span> <span style="font-weight: bold; font-style: italic;">charset</span>=<span style="font-style: italic;">"UTF-8"</span>&gt;
    &lt;<span style="font-weight: bold;">meta</span> <span style="font-weight: bold; font-style: italic;">name</span>=<span style="font-style: italic;">"viewport"</span> <span style="font-weight: bold; font-style: italic;">content</span>=<span style="font-style: italic;">"width=device-width, initial-scale=1.0"</span>&gt;
    &lt;<span style="font-weight: bold;">meta</span> <span style="font-weight: bold; font-style: italic;">name</span>=<span style="font-style: italic;">"description"</span> <span style="font-weight: bold; font-style: italic;">content</span>=<span style="font-style: italic;">"Project"</span>&gt;
    &lt;<span style="font-weight: bold;">title</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Project</span>&lt;/<span style="font-weight: bold;">title</span>&gt;
  &lt;/<span style="font-weight: bold;">head</span>&gt;
  &lt;<span style="font-weight: bold;">body</span>&gt;

    <span style="font-weight: bold; font-style: italic;">&lt;!-- </span><span style="font-weight: bold; font-style: italic;">This will act as a navbar</span><span style="font-weight: bold; font-style: italic;"> --&gt;</span>
    {% include 'base/navbar.html' %}

    {% block content %}

    {% endblock content %}

    <span style="font-weight: bold; font-style: italic;">&lt;!-- </span><span style="font-weight: bold; font-style: italic;">This will act as a footer</span><span style="font-weight: bold; font-style: italic;"> --&gt;</span>
    {% include 'base/footer.html' %}

  &lt;/<span style="font-weight: bold;">body</span>&gt;
&lt;/<span style="font-weight: bold;">html</span>&gt;
</pre>
</div>

<p>
Now create a <code>base/navbar.html</code> and <code>base/footer.html</code> pages:
</p>

<div class="org-src-container">
<pre class="src src-html"><span style="font-weight: bold; font-style: italic;">&lt;!-- </span><span style="font-weight: bold; font-style: italic;">navbar.html</span><span style="font-weight: bold; font-style: italic;"> --&gt;</span>
&lt;<span style="font-weight: bold;">p</span> <span style="font-weight: bold; font-style: italic;">class</span>=<span style="font-style: italic;">"navbar"</span>&gt;Hello this is navbar&lt;/<span style="font-weight: bold;">p</span>&gt;

{% if user.is_authenticated and user.is_superuser %}
&lt;<span style="font-weight: bold;">li</span>&gt;&lt;<span style="font-weight: bold;">a</span> <span style="font-weight: bold; font-style: italic;">href</span>=<span style="font-style: italic;">"{% url 'admin:index' %}"</span>&gt;Admin panel&lt;/<span style="font-weight: bold;">a</span>&gt;&lt;/<span style="font-weight: bold;">li</span>&gt;
{% endif %}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-html"><span style="font-weight: bold; font-style: italic;">&lt;!-- </span><span style="font-weight: bold; font-style: italic;">footer.html</span><span style="font-weight: bold; font-style: italic;"> --&gt;</span>
&lt;<span style="font-weight: bold;">p</span> <span style="font-weight: bold; font-style: italic;">class</span>=<span style="font-style: italic;">"footer"</span>&gt;Hello this is footer&lt;/<span style="font-weight: bold;">p</span>&gt;
</pre>
</div>

<p>
Check how homepage(index.html) looks now.
</p>
</div>
</div>
<div id="outline-container-org6dc0965" class="outline-3">
<h3 id="org6dc0965"><span class="section-number-3">3.8.</span> Add MISC items (Add css, js, images, debug toolbar)</h3>
<div class="outline-text-3" id="text-3-8">
</div>
<div id="outline-container-org53ae605" class="outline-4">
<h4 id="org53ae605"><span class="section-number-4">3.8.1.</span> Add css</h4>
<div class="outline-text-4" id="text-3-8-1">
<p>
In project's root directory, create a folder called <code>static</code>. Inside of it,
another folder called <code>css</code>. Inside of it, create a file called <code>base.css</code>.
</p>

<p>
It's contents for now:
</p>

<div class="org-src-container">
<pre class="src src-css"><span style="font-weight: bold;">p</span> {
    <span style="font-weight: bold;">color</span>: <span style="color: #000000; background-color: #008000;">green</span>;
}

<span style="font-weight: bold;">.navbar</span> {
    <span style="font-weight: bold;">padding</span>: 20px;
    <span style="font-weight: bold;">background-color</span>: <span style="color: #000000; background-color: #add8e6;">lightblue</span>;
}

<span style="font-weight: bold;">.footer</span> {
    <span style="font-weight: bold;">padding</span>: 20px;
    <span style="font-weight: bold;">background-color</span>: <span style="color: #000000; background-color: #d3d3d3;">lightgrey</span>;
}
</pre>
</div>

<p>
Inside of <code>base.html</code>, in head section, add this line:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="font-weight: bold;">link</span> <span style="font-weight: bold; font-style: italic;">rel</span>=<span style="font-style: italic;">"stylesheet"</span> <span style="font-weight: bold; font-style: italic;">type</span>=<span style="font-style: italic;">"text/css"</span> <span style="font-weight: bold; font-style: italic;">href</span>=<span style="font-style: italic;">"{% static 'css/base.css' %}"</span>&gt;
</pre>
</div>

<p>
Now at the top of <code>base.html</code> add this line:
</p>

<div class="org-src-container">
<pre class="src src-html">{% load static %}
</pre>
</div>

<p>
Make sure these are in your <code>settings.py</code> file:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold; font-style: italic;">STATIC_URL</span> = <span style="font-style: italic;">"static/"</span>
<span style="font-weight: bold; font-style: italic;">STATICFILES_DIRS</span> = [BASE_DIR / <span style="font-style: italic;">"static"</span>]
</pre>
</div>

<p>
Refresh your page. All the text should be green now, navbar and footer should
have some styling as well!
</p>
</div>
</div>

<div id="outline-container-org9b360ec" class="outline-4">
<h4 id="org9b360ec"><span class="section-number-4">3.8.2.</span> Add js</h4>
<div class="outline-text-4" id="text-3-8-2">
<p>
Create <code>static/js</code> folder and inside of it - <code>scripts.js</code> file.
</p>

<p>
Content of it:
</p>

<div class="org-src-container">
<pre class="src src-javascript"><span style="font-weight: bold;">function</span> <span style="font-weight: bold;">myFunction</span>() {
    alert(<span style="font-style: italic;">"Hello from a static file!"</span>);
  }
</pre>
</div>

<p>
Then in <code>base.html</code> include that script, put it just above the closing
<code>&lt;/body&gt;</code> tag like such:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="font-weight: bold;">script</span> <span style="font-weight: bold; font-style: italic;">src</span>=<span style="font-style: italic;">"{% static 'js/scripts.js' %}"</span>&gt;&lt;/<span style="font-weight: bold;">script</span>&gt;
</pre>
</div>

<p>
In <code>index.html</code> add a button that will trigger the alert function:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="font-weight: bold;">button</span> <span style="font-weight: bold; font-style: italic;">onclick</span>=<span style="font-style: italic;">"myFunction()"</span>&gt;JavaScript test&lt;/<span style="font-weight: bold;">button</span>&gt;
</pre>
</div>

<p>
Reload the page. Clicking on the button should trigger js code.
</p>
</div>
</div>

<div id="outline-container-orgba000a1" class="outline-4">
<h4 id="orgba000a1"><span class="section-number-4">3.8.3.</span> Add images</h4>
<div class="outline-text-4" id="text-3-8-3">
<p>
Now let's say you want to serve an image from the <code>index.html</code> page.
</p>

<p>
Place your image in <code>static/images/</code> folder,
</p>

<p>
Then in <code>index.html</code> add such two new lines:
</p>

<div class="org-src-container">
<pre class="src src-html"><span style="font-weight: bold; font-style: italic;">&lt;!-- </span><span style="font-weight: bold; font-style: italic;">index.html</span><span style="font-weight: bold; font-style: italic;"> --&gt;</span>
{% extends "base/base.html" %}

{% load static %} <span style="font-weight: bold; font-style: italic;">&lt;!-- </span><span style="font-weight: bold; font-style: italic;">new</span><span style="font-weight: bold; font-style: italic;"> --&gt;</span>

{% block content %}

&lt;<span style="font-weight: bold;">p</span>&gt;Hello&lt;/<span style="font-weight: bold;">p</span>&gt;

&lt;<span style="font-weight: bold;">img</span> <span style="font-weight: bold; font-style: italic;">src</span>=<span style="font-style: italic;">"{% static 'images/pineapple.jpeg' %}"</span>&gt; <span style="font-weight: bold; font-style: italic;">&lt;!-- </span><span style="font-weight: bold; font-style: italic;">new</span><span style="font-weight: bold; font-style: italic;"> --&gt;</span>

{% endblock content %}
</pre>
</div>

<p>
Refresh the page, image should be displayed.
</p>
</div>
</div>
</div>

<div id="outline-container-org7e4f2ab" class="outline-3">
<h3 id="org7e4f2ab"><span class="section-number-3">3.9.</span> Add bootstrap styling</h3>
<div class="outline-text-3" id="text-3-9">
<ul class="org-ul">
<li>Tailwind - needs node, bloats the html page</li>
<li>Bulma - never used, something new, not so popular?</li>
<li>Bootstrap - old and popular, got CND's for css/js</li>
</ul>

<p>
Choosing bootstrap.
</p>

<p>
In <code>base.html</code> add this to the head tag for bootstrap css:
</p>

<div class="org-src-container">
<pre class="src src-html">{% block css %}
<span style="font-weight: bold; font-style: italic;">&lt;!-- </span><span style="font-weight: bold; font-style: italic;">Bootstrap CSS</span><span style="font-weight: bold; font-style: italic;"> --&gt;</span>
&lt;<span style="font-weight: bold;">link</span> <span style="font-weight: bold; font-style: italic;">href</span>=<span style="font-style: italic;">"https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"</span> <span style="font-weight: bold; font-style: italic;">rel</span>=<span style="font-style: italic;">"stylesheet"</span>
      <span style="font-weight: bold; font-style: italic;">integrity</span>=<span style="font-style: italic;">"sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"</span> <span style="font-weight: bold; font-style: italic;">crossorigin</span>=<span style="font-style: italic;">"anonymous"</span>&gt;

{% endblock %}
</pre>
</div>

<p>
Find the latest tag here - <a href="https://www.bootstrapcdn.com/">https://www.bootstrapcdn.com/</a>
</p>

<p>
Then add boostrap js, at the bottom of the <code>base.html</code> page, at the closing body tag.
</p>

<div class="org-src-container">
<pre class="src src-html">{% block javascript %}
<span style="font-weight: bold; font-style: italic;">&lt;!-- </span><span style="font-weight: bold; font-style: italic;">Bootstrap JavaScript</span><span style="font-weight: bold; font-style: italic;"> --&gt;</span>
&lt;<span style="font-weight: bold;">script</span> <span style="font-weight: bold; font-style: italic;">src</span>=<span style="font-style: italic;">"https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"</span>
        <span style="font-weight: bold; font-style: italic;">integrity</span>=<span style="font-style: italic;">"sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"</span>
        <span style="font-weight: bold; font-style: italic;">crossorigin</span>=<span style="font-style: italic;">"anonymous"</span>&gt;&lt;/<span style="font-weight: bold;">script</span>&gt;
{% endblock javascript %}
</pre>
</div>

<p>
Bootstrap should work now.
</p>
</div>
</div>

<div id="outline-container-org115c6ab" class="outline-3">
<h3 id="org115c6ab"><span class="section-number-3">3.10.</span> HTML templates for error messages</h3>
<div class="outline-text-3" id="text-3-10">
<p>
Whenever the debug is True we will see the debug information and why certain
page could not be opened. But whenever the debug is False, we have nothing so
show as of now besides the standard web browser message.
</p>

<p>
Instead of that, we will create our own.
</p>

<p>
<a href="https://www.w3schools.com/django/django_404.php">https://www.w3schools.com/django/django_404.php</a>
</p>

<p>
Whenever the debug is True we will see the debug information and why
certain page could not be opened. But whenever the debug is False, we
have nothing so show as of now besides the standard web browser
message.
</p>

<p>
Instead of that, we will create our own.
</p>

<p>
<a href="https://www.w3schools.com/django/django_404.php">https://www.w3schools.com/django/django_404.php</a>
</p>

<p>
403_csrf.html
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends '_base.html' %}

{% block title %}Forbidden (403){% endblock title %}

{% block content %}
    &lt;<span style="font-weight: bold;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Forbidden (403)</span>&lt;/<span style="font-weight: bold;">h1</span>&gt;
    &lt;<span style="font-weight: bold;">p</span>&gt;CSRF verification failed. Request aborted.&lt;/<span style="font-weight: bold;">p</span>&gt;
{% endblock content %}
</pre>
</div>

<p>
404.html
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends '_base.html' %}

{% block title %}404 Page not found{% endblock %}

{% block content %}
    &lt;<span style="font-weight: bold;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Page not found</span>&lt;/<span style="font-weight: bold;">h1</span>&gt;
{% endblock content %}
</pre>
</div>

<p>
500.html
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends '_base.html' %}

{% block title %}500 Server Error{% endblock %}

{% block content %}
    &lt;<span style="font-weight: bold;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">500 Server Error</span>&lt;/<span style="font-weight: bold;">h1</span>&gt;
    &lt;<span style="font-weight: bold;">p</span>&gt;Looks like something went wrong!&lt;/<span style="font-weight: bold;">p</span>&gt;
{% endblock content %}
</pre>
</div>

<p>
Now turn debug to False, add allowed hosts and go to a random url to check if
the templates are being read:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold; font-style: italic;">DEBUG</span> = <span style="font-weight: bold; text-decoration: underline;">False</span>
<span style="font-weight: bold; font-style: italic;">ALLOWED_HOSTS</span> = [<span style="font-style: italic;">'127.0.0.1'</span>, <span style="font-style: italic;">'localhost'</span>]
</pre>
</div>
</div>
</div>

<div id="outline-container-org7f1dc9f" class="outline-3">
<h3 id="org7f1dc9f"><span class="section-number-3">3.11.</span> Environment variables</h3>
<div class="outline-text-3" id="text-3-11">
<p>
We don't want to push secret variables to github.
</p>

<p>
Such variables that should be kept secret are:
</p>
<ul class="org-ul">
<li>Secret key</li>
<li>Debug</li>
</ul>

<div class="org-src-container">
<pre class="src src-bash">pip install python-dotenv
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold;">from</span> dotenv <span style="font-weight: bold;">import</span> load_dotenv

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Load environment variables from .env</span>
load_dotenv()
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold; font-style: italic;">SECRET_KEY</span> = os.getenv(<span style="font-style: italic;">"SECRET_KEY"</span>)
<span style="font-weight: bold; font-style: italic;">DEBUG</span> = os.getenv(<span style="font-style: italic;">"DEBUG"</span>) == <span style="font-style: italic;">"True"</span>
</pre>
</div>

<p>
Now let's create .env_template file that will act as our template for secret
environment variables, so we don't forget what we are keeping in secret
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">no commas after variable declaration</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">no spaces before/after =</span>

<span style="font-weight: bold; font-style: italic;">SECRET_KEY</span>=<span style="font-style: italic;">""</span>
<span style="font-weight: bold; font-style: italic;">DEBUG</span>=True

<span style="font-weight: bold; font-style: italic;">POSTGRESQL_REMOTE_DB_NAME</span>=<span style="font-style: italic;">""</span>
<span style="font-weight: bold; font-style: italic;">POSTGRESQL_REMOTE_DB_USER</span>=<span style="font-style: italic;">""</span>
<span style="font-weight: bold; font-style: italic;">POSTGRESQL_REMOTE_DB_PASSWORD</span>=<span style="font-style: italic;">""</span>
<span style="font-weight: bold; font-style: italic;">POSTGRESQL_REMOTE_DB_HOST</span>=<span style="font-style: italic;">""</span>
<span style="font-weight: bold; font-style: italic;">POSTGRESQL_REMOTE_DB_PORT</span>=<span style="font-style: italic;">""</span>

<span style="font-weight: bold; font-style: italic;">POSTGRESQL_LOCAL_DB_NAME</span>=<span style="font-style: italic;">""</span>
<span style="font-weight: bold; font-style: italic;">POSTGRESQL_LOCAL_DB_USER</span>=<span style="font-style: italic;">""</span>
<span style="font-weight: bold; font-style: italic;">POSTGRESQL_LOCAL_DB_PASSWORD</span>=<span style="font-style: italic;">""</span>
<span style="font-weight: bold; font-style: italic;">POSTGRESQL_LOCAL_DB_HOST</span>=<span style="font-style: italic;">""</span>
<span style="font-weight: bold; font-style: italic;">POSTGRESQL_LOCAL_DB_PORT</span>=<span style="font-style: italic;">""</span>

<span style="font-weight: bold; font-style: italic;">MYSQL_LOCAL_DB_NAME</span>=<span style="font-style: italic;">""</span>
<span style="font-weight: bold; font-style: italic;">MYSQL_LOCAL_DB_USER</span>=<span style="font-style: italic;">""</span>
<span style="font-weight: bold; font-style: italic;">MYSQL_LOCAL_DB_PASSWORD</span>=<span style="font-style: italic;">""</span>
</pre>
</div>

<p>
Now copy <code>.env_template</code> file and make <code>.env</code> out of it, populate
debug(true/false) and secret variable definition with whatever you like.
</p>

<p>
Now you can change those variables from <code>.env</code> file.
</p>

<p>
Make sure this <code>.env</code> file is not being committed to git, add it to
<code>.gitignore</code>.
</p>
</div>
</div>
</div>

<div id="outline-container-orgf672b4d" class="outline-2">
<h2 id="orgf672b4d"><span class="section-number-2">4.</span> Authentication</h2>
<div class="outline-text-2" id="text-4">
<ul class="org-ul">
<li>Biggest inspiration - <a href="https://learndjango.com/tutorials/django-login-and-logout-tutorial">here</a></li>
<li>Another useful resource - <a href="https://simpleisbetterthancomplex.com/tutorial/2016/07/22/how-to-extend-django-user-model.html#abstractbaseuser">here</a></li>
</ul>
</div>

<div id="outline-container-org2c439eb" class="outline-3">
<h3 id="org2c439eb"><span class="section-number-3">4.1.</span> Django allauth</h3>
<div class="outline-text-3" id="text-4-1">
<ul class="org-ul">
<li><a href="https://www.youtube.com/watch?v=qqFCt0Yde40&amp;ab_channel=MattFreire">Nice quick rundown of the package</a></li>
<li><a href="https://www.youtube.com/watch?v=mIlgzn2zuFE&amp;ab_channel=PrettyPrinted">Quick installation guide of allauth</a></li>
<li><a href="https://docs.allauth.org/en/latest/index.html">Official docs</a></li>
</ul>

<p>
So&#x2026; In previous steps we have got to know to <a href="20240531T084241--getting-to-know-to-built-in-django-authentication-system__django_python.html">built in Django authentication</a>
and we also <a href="20240531T084619--creating-a-custom-user-model-in-django__django_python.html">created a custom user model</a> so in the future, if we need to, we
could create additional fields for the user model (bio, country, hobbies, etc,
whatever).
</p>

<p>
We have also created login template and signup template+view.
</p>

<p>
We are able to sign in, able to login/logout, etc.
</p>

<p>
But why not add a <code>django-allauth</code> package, that would ensure that in the
future we are able to use social account sign ups, etc? Honestly I heard about this
package a lot in the past, but never used it. Let's try it.
</p>

<blockquote>
<p>
BIG NOTE: "allauth" package is included with quote BIG batteries. All the
previous attempts to modify the user model will have to be put on the shelf
now, because "allauth" takes care of them. Regarding the custom user model -
currently don't know how to implement it with "allauth", but will leave that
for the future.
</p>
</blockquote>
</div>

<div id="outline-container-orgd7d4b7f" class="outline-4">
<h4 id="orgd7d4b7f"><span class="section-number-4">4.1.1.</span> Installation</h4>
<div class="outline-text-4" id="text-4-1-1">
<p>
<a href="https://docs.allauth.org/en/latest/installation/quickstart.html">https://docs.allauth.org/en/latest/installation/quickstart.html</a>
</p>

<div class="org-src-container">
<pre class="src src-sh">pip install django-allauth[socialaccount]
</pre>
</div>

<p>
Add this to <code>settings.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold; font-style: italic;">AUTHENTICATION_BACKENDS</span> = [
    ...
    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Needed to login by username in Django admin, regardless of `allauth`</span>
    <span style="font-style: italic;">'django.contrib.auth.backends.ModelBackend'</span>,

    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">`allauth` specific authentication methods, such as login by email</span>
    <span style="font-style: italic;">'allauth.account.auth_backends.AuthenticationBackend'</span>,
    ...
]
</pre>
</div>

<p>
Add a few apps too:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="font-style: italic;">'allauth'</span>,
<span style="font-style: italic;">'allauth.account'</span>,
<span style="font-style: italic;">'allauth.socialaccount'</span>,
</pre>
</div>

<p>
Add this middleware to the end of the list:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Add the account middleware:</span>
 <span style="font-style: italic;">"allauth.account.middleware.AccountMiddleware"</span>,
</pre>
</div>

<p>
Also this line is needed, but we have it from previous setup:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">django_project/settings.py</span>
<span style="font-weight: bold; font-style: italic;">EMAIL_BACKEND</span> = <span style="font-style: italic;">"django.core.mail.backends.console.EmailBackend"</span> <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">new</span>
</pre>
</div>

<p>
Now we have to modify the <code>project/urls.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold; font-style: italic;">urlpatterns</span> = [
    path(<span style="font-style: italic;">"administratorius/"</span>, admin.site.urls),
    path(<span style="font-style: italic;">"accounts/"</span>, include(<span style="font-style: italic;">"allauth.urls"</span>)),             <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">new</span>
    path(<span style="font-style: italic;">""</span>, Index.as_view(), name=<span style="font-style: italic;">"index"</span>),
    path(<span style="font-style: italic;">"test/"</span>, test, name=<span style="font-style: italic;">"test"</span>),
]
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python">python manage.py migrate
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash">python manage.py migrate
Operations to perform:
  Apply all migrations: account, accounts, admin, auth, contenttypes, sessions, socialaccount
Running migrations:
  Applying account.0001_initial... OK
  Applying account.0002_email_max_length... OK
  Applying account.0003_alter_emailaddress_create_unique_verified_email... OK
  Applying account.0004_alter_emailaddress_drop_unique_email... OK
  Applying account.0005_emailaddress_idx_upper_email... OK
  Applying account.0006_emailaddress_lower... OK
  Applying account.0007_emailaddress_idx_email... OK
  Applying account.0008_emailaddress_unique_primary_email_fixup... OK
  Applying account.0009_emailaddress_unique_primary_email... OK
  Applying socialaccount.0001_initial... OK
  Applying socialaccount.0002_token_max_lengths... OK
  Applying socialaccount.0003_extra_data_default_dict... OK
  Applying socialaccount.0004_app_provider_id_settings... OK
  Applying socialaccount.0005_socialtoken_nullable_app... OK
  Applying socialaccount.0006_alter_socialaccount_extra_data... OK
</pre>
</div>

<p>
Now if we login to admin panel, we should see the new apps registered.
</p>

<p>
To make email required when creating an account, add these to <code>settings.py</code>:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold; font-style: italic;">ACCOUNT_AUTHENTICATION_METHOD</span> = <span style="font-style: italic;">"email"</span>
<span style="font-weight: bold; font-style: italic;">ACCOUNT_EMAIL_REQUIRED</span> = <span style="font-weight: bold; text-decoration: underline;">True</span>
</pre>
</div>

<p>
Here are all the possible <i>accounts</i> url's now:
</p>

<div class="org-src-container">
<pre class="src src-bash">accounts/ login/ [<span style="font-weight: bold; font-style: italic;">name</span>=<span style="font-style: italic;">'account_login'</span>]
accounts/ logout/ [<span style="font-weight: bold; font-style: italic;">name</span>=<span style="font-style: italic;">'account_logout'</span>]
accounts/ inactive/ [<span style="font-weight: bold; font-style: italic;">name</span>=<span style="font-style: italic;">'account_inactive'</span>]
accounts/ signup/ [<span style="font-weight: bold; font-style: italic;">name</span>=<span style="font-style: italic;">'account_signup'</span>]
accounts/ reauthenticate/ [<span style="font-weight: bold; font-style: italic;">name</span>=<span style="font-style: italic;">'account_reauthenticate'</span>]
accounts/ email/ [<span style="font-weight: bold; font-style: italic;">name</span>=<span style="font-style: italic;">'account_email'</span>]
accounts/ confirm-email/ [<span style="font-weight: bold; font-style: italic;">name</span>=<span style="font-style: italic;">'account_email_verification_sent'</span>]
accounts/ ^confirm-email/(?P&lt;key&gt;[-:\w]+)/$ [<span style="font-weight: bold; font-style: italic;">name</span>=<span style="font-style: italic;">'account_confirm_email'</span>]
accounts/ password/change/ [<span style="font-weight: bold; font-style: italic;">name</span>=<span style="font-style: italic;">'account_change_password'</span>]
accounts/ password/set/ [<span style="font-weight: bold; font-style: italic;">name</span>=<span style="font-style: italic;">'account_set_password'</span>]
accounts/ password/reset/ [<span style="font-weight: bold; font-style: italic;">name</span>=<span style="font-style: italic;">'account_reset_password'</span>]
accounts/ password/reset/done/ [<span style="font-weight: bold; font-style: italic;">name</span>=<span style="font-style: italic;">'account_reset_password_done'</span>]
accounts/ ^password/reset/key/(?P&lt;uidb36&gt;[0-9A-Za-z]+)-(?P&lt;key&gt;.+)/$ [<span style="font-weight: bold; font-style: italic;">name</span>=<span style="font-style: italic;">'account_reset_password_from_key'</span>]
accounts/ password/reset/key/done/ [<span style="font-weight: bold; font-style: italic;">name</span>=<span style="font-style: italic;">'account_reset_password_from_key_done'</span>]
accounts/ 3rdparty/
accounts/ social/login/cancelled/
accounts/ social/login/error/
accounts/ social/signup/
accounts/ social/connections/
</pre>
</div>

<p>
Try going to them and see how they look.
</p>
</div>
</div>
</div>

<div id="outline-container-orgf1eda73" class="outline-3">
<h3 id="orgf1eda73"><span class="section-number-3">4.2.</span> Style allauth templates, Implement crispy forms</h3>
<div class="outline-text-3" id="text-4-2">
<p>
Crispy forms will allow us to style the forms nicer.
</p>

<p>
Docs - <a href="https://django-crispy-forms.readthedocs.io/en/latest/index.html">https://django-crispy-forms.readthedocs.io/en/latest/index.html</a>
</p>

<p>
Great video explaining crispy forms -
<a href="https://www.youtube.com/watch?v=MZwKoi0wu2Q&amp;ab_channel=BugBytes">https://www.youtube.com/watch?v=MZwKoi0wu2Q&amp;ab_channel=BugBytes</a>
</p>

<p>
Install two needed packages:
</p>

<div class="org-src-container">
<pre class="src src-bash">pip install django-crispy-forms
pip install crispy-bootstrap5
</pre>
</div>

<p>
add new apps to base.py settings file:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="font-style: italic;">"crispy_forms"</span>,
<span style="font-style: italic;">"crispy_bootstrap5"</span>,
</pre>
</div>

<p>
at the bottom of this file also add:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">django-crispy-forms</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">https://django-crispy-forms.readthedocs.io/en/latest/install.html#template-packs</span>
<span style="font-weight: bold; font-style: italic;">CRISPY_TEMPLATE_PACK</span> = <span style="font-style: italic;">"bootstrap5"</span>
</pre>
</div>

<p>
then in login.html, password_reset_confirm.html,
password_reset_form.html, signup.html add <code>{% load crispy_forms_tags %}</code>
at the top of the file, under _base.html extension. Also change each
form field with <code>{{ form|crispy }}</code>.
</p>

<p>
An example for login.html page:
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block title %}Log in{% endblock %}

{% block content %}
&lt;<span style="font-weight: bold;">h2</span>&gt;<span style="font-weight: bold; font-style: italic; text-decoration: underline;">Log in</span>&lt;/<span style="font-weight: bold;">h2</span>&gt;
&lt;<span style="font-weight: bold;">form</span> <span style="font-weight: bold; font-style: italic;">method</span>=<span style="font-style: italic;">"post"</span>&gt;
    {% csrf_token %}
    {{ form|crispy }}
    &lt;<span style="font-weight: bold;">button</span> <span style="font-weight: bold; font-style: italic;">class</span>=<span style="font-style: italic;">"btn btn-success"</span> <span style="font-weight: bold; font-style: italic;">type</span>=<span style="font-style: italic;">"submit"</span>&gt;Log in&lt;/<span style="font-weight: bold;">button</span>&gt;
&lt;/<span style="font-weight: bold;">form</span>&gt;
&lt;<span style="font-weight: bold;">a</span> <span style="font-weight: bold; font-style: italic;">href</span>=<span style="font-style: italic;">"{% url 'account_reset_password' %}"</span>&gt;Forgot Password?&lt;/<span style="font-weight: bold;">a</span>&gt;
{% endblock content %}
</pre>
</div>

<p>
Now when you refresh any of the page that contains a form - it should
look more nice :)
</p>

<p>
Do the same for all "allauth" pages
</p>

<p>
logout.html
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block title %}Log out{% endblock %}


{% block content %}
&lt;<span style="font-weight: bold;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Sign Out</span>&lt;/<span style="font-weight: bold;">h1</span>&gt;

&lt;<span style="font-weight: bold;">p</span>&gt;Are you sure you want to sign out?&lt;/<span style="font-weight: bold;">p</span>&gt;

&lt;<span style="font-weight: bold;">form</span> <span style="font-weight: bold; font-style: italic;">method</span>=<span style="font-style: italic;">"post"</span> <span style="font-weight: bold; font-style: italic;">action</span>=<span style="font-style: italic;">"{% url 'account_logout' %}"</span>&gt;
    {% csrf_token %}
    {{ form|crispy }}
    &lt;<span style="font-weight: bold;">button</span> <span style="font-weight: bold; font-style: italic;">class</span>=<span style="font-style: italic;">"btn btn-danger"</span> <span style="font-weight: bold; font-style: italic;">type</span>=<span style="font-style: italic;">"submit"</span>&gt;Sign Out&lt;/<span style="font-weight: bold;">button</span>&gt;
&lt;/<span style="font-weight: bold;">form</span>&gt;

{% endblock content %}
</pre>
</div>

<p>
password_change.html
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block title %}Change Password{% endblock %}

{% block content %}
&lt;<span style="font-weight: bold;">h2</span>&gt;<span style="font-weight: bold; font-style: italic; text-decoration: underline;">Change Password</span>&lt;/<span style="font-weight: bold;">h2</span>&gt;
&lt;<span style="font-weight: bold;">form</span> <span style="font-weight: bold; font-style: italic;">method</span>=<span style="font-style: italic;">"post"</span> <span style="font-weight: bold; font-style: italic;">action</span>=<span style="font-style: italic;">"{% url 'account_change_password' %}"</span>&gt;
    {% csrf_token %}
    {{ form|crispy }}
    &lt;<span style="font-weight: bold;">button</span> <span style="font-weight: bold; font-style: italic;">class</span>=<span style="font-style: italic;">"btn btn-success"</span> <span style="font-weight: bold; font-style: italic;">type</span>=<span style="font-style: italic;">"submit"</span>&gt;Change Password&lt;/<span style="font-weight: bold;">button</span>&gt;
&lt;/<span style="font-weight: bold;">form</span>&gt;
{% endblock content %}
</pre>
</div>

<p>
password_reset_done.html
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block title %}Password Reset Done{% endblock %}

{% block content %}
&lt;<span style="font-weight: bold;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Password Reset</span>&lt;/<span style="font-weight: bold;">h1</span>&gt;
&lt;<span style="font-weight: bold;">p</span>&gt;We have sent you an e-mail. Please contact us if you do not receive it in a few minutes.&lt;/<span style="font-weight: bold;">p</span>&gt;
{% endblock content %}
</pre>
</div>

<p>
password_reset_from_key_done.html
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block title %}Change Password Done{% endblock title %}

{% block content %}
&lt;<span style="font-weight: bold;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">Password Change Done</span>&lt;/<span style="font-weight: bold;">h1</span>&gt;
&lt;<span style="font-weight: bold;">p</span>&gt;Your password has been changed.&lt;/<span style="font-weight: bold;">p</span>&gt;
{% endblock content %}
</pre>
</div>

<p>
password_reset_from_key.html
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block title %}Change Password{% endblock title %}

{% block content %}
&lt;<span style="font-weight: bold;">h1</span>&gt;<span style="font-weight: bold; text-decoration: underline;">{% if token_fail %}Bad Token{% else %}Change Password{% endif %}</span>&lt;/<span style="font-weight: bold;">h1</span>&gt;

{% if token_fail %}
&lt;<span style="font-weight: bold;">p</span>&gt;The password reset link was invalid. Perhaps it has already been used?  Please request a &lt;<span style="font-weight: bold;">a</span> <span style="font-weight: bold; font-style: italic;">href</span>=<span style="font-style: italic;">"{% url 'account_reset_password' %}"</span>&gt;new password reset&lt;/<span style="font-weight: bold;">a</span>&gt;.&lt;/<span style="font-weight: bold;">p</span>&gt;
{% else %}
{% if form %}
&lt;<span style="font-weight: bold;">form</span> <span style="font-weight: bold; font-style: italic;">method</span>=<span style="font-style: italic;">"POST"</span> <span style="font-weight: bold; font-style: italic;">action</span>=<span style="font-style: italic;">"."</span>&gt;
    {% csrf_token %}
    {{ form|crispy }}
    &lt;<span style="font-weight: bold;">button</span> <span style="font-weight: bold; font-style: italic;">class</span>=<span style="font-style: italic;">"btn btn-primary"</span> <span style="font-weight: bold; font-style: italic;">type</span>=<span style="font-style: italic;">"submit"</span>&gt;Change Password&lt;/<span style="font-weight: bold;">button</span>&gt;
&lt;/<span style="font-weight: bold;">form</span>&gt;
{% else %}
&lt;<span style="font-weight: bold;">p</span>&gt;Your password is now changed.&lt;/<span style="font-weight: bold;">p</span>&gt;
{% endif %}
{% endif %}
{% endblock content%}
</pre>
</div>

<p>
password_reset.html
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block title %}Password Reset{% endblock %}

{% block content %}
&lt;<span style="font-weight: bold;">h2</span>&gt;<span style="font-weight: bold; font-style: italic; text-decoration: underline;">Forgot your password? </span>&lt;/<span style="font-weight: bold;">h2</span>&gt;
&lt;<span style="font-weight: bold;">form</span> <span style="font-weight: bold; font-style: italic;">method</span>=<span style="font-style: italic;">"POST"</span> <span style="font-weight: bold; font-style: italic;">action</span>=<span style="font-style: italic;">"{% url 'account_reset_password' %}"</span> <span style="font-weight: bold; font-style: italic;">class</span>=<span style="font-style: italic;">"password_reset"</span>&gt;
    {% csrf_token %}
    {{ form | crispy }}
    &lt;<span style="font-weight: bold;">button</span> <span style="font-weight: bold; font-style: italic;">class</span>=<span style="font-style: italic;">"btn btn-primary"</span> <span style="font-weight: bold; font-style: italic;">type</span>=<span style="font-style: italic;">"submit"</span>&gt;Reset Password&lt;/<span style="font-weight: bold;">button</span>&gt;
&lt;/<span style="font-weight: bold;">form</span>&gt;
{% endblock content %}
</pre>
</div>

<p>
password_set.html
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block title %}Set Password{% endblock title %}

{% block content %}
&lt;<span style="font-weight: bold;">form</span> <span style="font-weight: bold; font-style: italic;">method</span>=<span style="font-style: italic;">"POST"</span> <span style="font-weight: bold; font-style: italic;">action</span>=<span style="font-style: italic;">""</span> <span style="font-weight: bold; font-style: italic;">class</span>=<span style="font-style: italic;">"password_set"</span>&gt;
    {% csrf_token %}
    {{ form | crispy }}
    &lt;<span style="font-weight: bold;">div</span> <span style="font-weight: bold; font-style: italic;">class</span>=<span style="font-style: italic;">"form-actions"</span>&gt;
        &lt;<span style="font-weight: bold;">button</span> <span style="font-weight: bold; font-style: italic;">class</span>=<span style="font-style: italic;">"btn btn-primary"</span> <span style="font-weight: bold; font-style: italic;">type</span>=<span style="font-style: italic;">"submit"</span> <span style="font-weight: bold; font-style: italic;">name</span>=<span style="font-style: italic;">"action"</span> <span style="font-weight: bold; font-style: italic;">value</span>=<span style="font-style: italic;">"Set Password"</span>&gt;Change
            Password&lt;/<span style="font-weight: bold;">button</span>&gt;
    &lt;/<span style="font-weight: bold;">div</span>&gt;
&lt;/<span style="font-weight: bold;">form</span>&gt;
{% endblock content %}
</pre>
</div>

<p>
signup.html
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block title %}Sign up{% endblock %}

{% block content %}
&lt;<span style="font-weight: bold;">h2</span>&gt;<span style="font-weight: bold; font-style: italic; text-decoration: underline;">Sign up</span>&lt;/<span style="font-weight: bold;">h2</span>&gt;
&lt;<span style="font-weight: bold;">form</span> <span style="font-weight: bold; font-style: italic;">method</span>=<span style="font-style: italic;">"post"</span>&gt;
    {% csrf_token %}
    {{ form|crispy }}
    &lt;<span style="font-weight: bold;">button</span> <span style="font-weight: bold; font-style: italic;">class</span>=<span style="font-style: italic;">"btn btn-success"</span> <span style="font-weight: bold; font-style: italic;">type</span>=<span style="font-style: italic;">"submit"</span>&gt;Sign up&lt;/<span style="font-weight: bold;">button</span>&gt;
&lt;/<span style="font-weight: bold;">form</span>&gt;
{% endblock content %}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc8176e1" class="outline-3">
<h3 id="orgc8176e1"><span class="section-number-3">4.3.</span> Create a user dashboard</h3>
<div class="outline-text-3" id="text-4-3">
<p>
By default, after successful login, allauth leads us to "accounts/profile/"
page. It does not exist by default, let's create it.
</p>

<p>
First, let's create an app for a dashboard:
</p>

<div class="org-src-container">
<pre class="src src-bash">django-admin start app dashboard
</pre>
</div>

<p>
Add the app to <code>INSTALLED_APPS</code>, then let's create a view for the profile:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold; text-decoration: underline;">@login_required</span>
<span style="font-weight: bold;">def</span> <span style="font-weight: bold;">profile</span>(request):

    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Get the logged-in user</span>
    <span style="font-weight: bold; font-style: italic;">user</span> = request.user

    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;"># Use dir() to see the available attributes and methods</span>
    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">user_attributes = dir(user)</span>
    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">print(f"user attributes: {user_attributes}")</span>

    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;"># Print the attributes one per line</span>
    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">for attribute in user_attributes:</span>
    <span style="font-weight: bold; font-style: italic;">#     </span><span style="font-weight: bold; font-style: italic;">print(attribute)</span>

    <span style="font-weight: bold; font-style: italic;">context</span> = {
        <span style="font-style: italic;">"user_id"</span>: user.<span style="font-weight: bold;">id</span>,
        <span style="font-style: italic;">"user_password"</span>: user.password,
        <span style="font-style: italic;">"user_last_login"</span>: user.last_login,
        <span style="font-style: italic;">"user_is_superuser"</span>: user.is_superuser,
        <span style="font-style: italic;">"user_name"</span>: user.username,
        <span style="font-style: italic;">"user_fist_name"</span>: user.first_name,
        <span style="font-style: italic;">"user_last_name"</span>: user.last_name,
        <span style="font-style: italic;">"user_email"</span>: user.email,
        <span style="font-style: italic;">"user_is_staff"</span>: user.is_staff,
        <span style="font-style: italic;">"user_is_active"</span>: user.is_active,
        <span style="font-style: italic;">"user_date_joined"</span>: user.date_joined,
    }

    <span style="font-weight: bold;">return</span> render(request, <span style="font-style: italic;">"registration/dashboard.html"</span>, context)
</pre>
</div>

<p>
Then update the urls of the project:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold;">from</span> apps.dashboard.views <span style="font-weight: bold;">import</span> profile

<span style="font-weight: bold; font-style: italic;">urlpatterns</span> = [
    path(<span style="font-style: italic;">"accounts/profile/"</span>, profile, name=<span style="font-style: italic;">"profile"</span>), <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">new</span>
]
</pre>
</div>

<p>
Add a link to the dashboard in <code>navbar.html</code>:
</p>

<div class="org-src-container">
<pre class="src src-html">&lt;<span style="font-weight: bold;">li</span>&gt;&lt;<span style="font-weight: bold;">a</span> <span style="font-weight: bold; font-style: italic;">class</span>=<span style="font-style: italic;">"dropdown-item"</span> <span style="font-weight: bold; font-style: italic;">href</span>=<span style="font-style: italic;">"{% url 'profile' %}"</span>&gt;User Dashboard&lt;/<span style="font-weight: bold;">a</span>&gt;&lt;/<span style="font-weight: bold;">li</span>&gt;
</pre>
</div>

<p>
Then in <code>templates/account/profile.html</code>:
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends "base.html" %}

{% block content %}

    &lt;<span style="font-weight: bold;">h2</span>&gt;<span style="font-weight: bold; font-style: italic; text-decoration: underline;">Welcome to your dashboard, {{ user_name }}!</span>&lt;/<span style="font-weight: bold;">h2</span>&gt;

    &lt;<span style="font-weight: bold;">p</span>&gt;&lt;<span style="font-weight: bold;">strong</span>&gt;<span style="font-weight: bold;">User id:</span>&lt;/<span style="font-weight: bold;">strong</span>&gt; {{ user_id }}&lt;/<span style="font-weight: bold;">p</span>&gt;
    &lt;<span style="font-weight: bold;">p</span>&gt;&lt;<span style="font-weight: bold;">strong</span>&gt;<span style="font-weight: bold;">Password:</span>&lt;/<span style="font-weight: bold;">strong</span>&gt; {{ user_password }}&lt;/<span style="font-weight: bold;">p</span>&gt;
    &lt;<span style="font-weight: bold;">p</span>&gt;&lt;<span style="font-weight: bold;">strong</span>&gt;<span style="font-weight: bold;">Last login:</span>&lt;/<span style="font-weight: bold;">strong</span>&gt; {{ user_last_login }}&lt;/<span style="font-weight: bold;">p</span>&gt;
    &lt;<span style="font-weight: bold;">p</span>&gt;&lt;<span style="font-weight: bold;">strong</span>&gt;<span style="font-weight: bold;">Is superuser:</span>&lt;/<span style="font-weight: bold;">strong</span>&gt; {{ user_is_superuser }}&lt;/<span style="font-weight: bold;">p</span>&gt;
    &lt;<span style="font-weight: bold;">p</span>&gt;&lt;<span style="font-weight: bold;">strong</span>&gt;<span style="font-weight: bold;">User name:</span>&lt;/<span style="font-weight: bold;">strong</span>&gt; {{ user_name }}&lt;/<span style="font-weight: bold;">p</span>&gt;
    &lt;<span style="font-weight: bold;">p</span>&gt;&lt;<span style="font-weight: bold;">strong</span>&gt;<span style="font-weight: bold;">First name:</span>&lt;/<span style="font-weight: bold;">strong</span>&gt; {{ user_first_name }}&lt;/<span style="font-weight: bold;">p</span>&gt;
    &lt;<span style="font-weight: bold;">p</span>&gt;&lt;<span style="font-weight: bold;">strong</span>&gt;<span style="font-weight: bold;">Last name:</span>&lt;/<span style="font-weight: bold;">strong</span>&gt; {{ user_last_name }}&lt;/<span style="font-weight: bold;">p</span>&gt;
    &lt;<span style="font-weight: bold;">p</span>&gt;&lt;<span style="font-weight: bold;">strong</span>&gt;<span style="font-weight: bold;">Email:</span>&lt;/<span style="font-weight: bold;">strong</span>&gt; {{ user_email }}&lt;/<span style="font-weight: bold;">p</span>&gt;
    &lt;<span style="font-weight: bold;">p</span>&gt;&lt;<span style="font-weight: bold;">strong</span>&gt;<span style="font-weight: bold;">Is staff:</span>&lt;/<span style="font-weight: bold;">strong</span>&gt; {{ user_is_staff }}&lt;/<span style="font-weight: bold;">p</span>&gt;
    &lt;<span style="font-weight: bold;">p</span>&gt;&lt;<span style="font-weight: bold;">strong</span>&gt;<span style="font-weight: bold;">Is active:</span>&lt;/<span style="font-weight: bold;">strong</span>&gt; {{ user_is_active }}&lt;/<span style="font-weight: bold;">p</span>&gt;
    &lt;<span style="font-weight: bold;">p</span>&gt;&lt;<span style="font-weight: bold;">strong</span>&gt;<span style="font-weight: bold;">Date joined:</span>&lt;/<span style="font-weight: bold;">strong</span>&gt; {{ user_date_joined }}&lt;/<span style="font-weight: bold;">p</span>&gt;

    &lt;<span style="font-weight: bold;">a</span> <span style="font-weight: bold; font-style: italic;">href</span>=<span style="font-style: italic;">"{% url 'account_reset_password' %}"</span>&gt;Password reset&lt;/<span style="font-weight: bold;">a</span>&gt;

    &lt;<span style="font-weight: bold;">p</span>&gt;&lt;<span style="font-weight: bold;">a</span> <span style="font-weight: bold; font-style: italic;">href</span>=<span style="font-style: italic;">"{% url 'account_change_password' %}"</span>&gt;Password Change&lt;/<span style="font-weight: bold;">a</span>&gt;&lt;/<span style="font-weight: bold;">p</span>&gt;

{% endblock content %}
</pre>
</div>

<p>
User dashboard should be reachable now.
</p>
</div>
</div>

<div id="outline-container-orgfe781bb" class="outline-3">
<h3 id="orgfe781bb"><span class="section-number-3">4.4.</span> Enable social login with Google</h3>
<div class="outline-text-3" id="text-4-4">
<p>
Possible providers -
<a href="https://docs.allauth.org/en/latest/socialaccount/providers/index.html">https://docs.allauth.org/en/latest/socialaccount/providers/index.html</a>
</p>

<p>
If you want to disable third party authentication with google, simply comment
out <code>"allauth.socialaccount.providers.google",</code> in <code>settings.py</code> and
login/signup pages should not display an option to login with google anymore.
</p>

<p>
To <code>INSTALLED_APPS</code> add:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="font-style: italic;">"allauth.socialaccount.providers.google"</span>,
</pre>
</div>
</div>

<div id="outline-container-orgcbc9196" class="outline-4">
<h4 id="orgcbc9196"><span class="section-number-4">4.4.1.</span> Add social application in django-admin</h4>
<div class="outline-text-4" id="text-4-4-1">
<p>
Then go to <code>http://localhost:8000/admin/socialaccount/socialapp/add/</code> and add a
social application:
</p>

<ul class="org-ul">
<li>Go to google develope dashboard</li>
<li>Create a project if you don't already have one</li>
<li>Go to APIs and services tab -&gt; credentials</li>
<li>Create credentials -&gt; Create OAuth client ID</li>
<li>Go through a conscent screen if asked</li>
<li>After it, continue with the OAuth client ID creation</li>
<li>application type - web application</li>
<li>authorized redirect urls -
<code>http://127.0.0.1:8000/accounts/google/login/callback/</code> (make sure to be
running the project locally over 127.0.0.1 and not over localhost if you
specify it like so here)</li>
<li>Click create</li>
<li>Copy the cliend id and secret to the django social application page that we
previously were on and save the application</li>
</ul>
</div>
</div>

<div id="outline-container-orge9820ea" class="outline-4">
<h4 id="orge9820ea"><span class="section-number-4">4.4.2.</span> Attempt to register</h4>
<div class="outline-text-4" id="text-4-4-2">
<p>
Try to register an account with through google now (in signup page you should
see "third party authentication button"). Our custom "signup.html" template
might be preventing that, so disable it, we will modify it later.
</p>

<p>
If you want to login with social account - do the "third party" thing again in
the login page. (have to modify the login.html template also).
</p>

<p>
After successful registration, in "social_accounts" in django-admin you should
see the account that has just been created.
</p>
</div>
</div>

<div id="outline-container-org9a997c6" class="outline-4">
<h4 id="org9a997c6"><span class="section-number-4">4.4.3.</span> Modify the templates to accommodate third party buttons</h4>
<div class="outline-text-4" id="text-4-4-3">
<p>
Modify sign up/login templates and Third-Party Login Failure template
modify the second AFTER sign up template
</p>

<p>
<code>account/login.html</code> now looks like this:
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block title %}Log in{% endblock %}

{% block content %}
&lt;<span style="font-weight: bold;">h2</span>&gt;<span style="font-weight: bold; font-style: italic; text-decoration: underline;">Log in</span>&lt;/<span style="font-weight: bold;">h2</span>&gt;
&lt;<span style="font-weight: bold;">form</span> <span style="font-weight: bold; font-style: italic;">method</span>=<span style="font-style: italic;">"post"</span>&gt;
    {% csrf_token %}
    {{ form|crispy }}
    &lt;<span style="font-weight: bold;">button</span> <span style="font-weight: bold; font-style: italic;">class</span>=<span style="font-style: italic;">"btn btn-success"</span> <span style="font-weight: bold; font-style: italic;">type</span>=<span style="font-style: italic;">"submit"</span>&gt;Log in&lt;/<span style="font-weight: bold;">button</span>&gt;
&lt;/<span style="font-weight: bold;">form</span>&gt;
&lt;<span style="font-weight: bold;">a</span> <span style="font-weight: bold; font-style: italic;">href</span>=<span style="font-style: italic;">"{% url 'account_reset_password' %}"</span>&gt;Forgot Password?&lt;/<span style="font-weight: bold;">a</span>&gt;


{% load i18n %}
{% load allauth %}
{% load socialaccount %}
{% get_providers as socialaccount_providers %}
{% if socialaccount_providers %}
{% if not SOCIALACCOUNT_ONLY %}
{% element hr %}
{% endelement %}
{% element h2 %}
{% translate "Or use a third-party" %}
{% endelement %}
{% endif %}
{% include "socialaccount/snippets/provider_list.html" with <span style="font-weight: bold; font-style: italic;">process</span>="login" %}
{% include "socialaccount/snippets/login_extra.html" %}
{% endif %}


{% endblock content %}
</pre>
</div>

<p>
<code>account/signup.html</code> now looks like this:
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% load allauth i18n %}

{% block title %}Sign up{% endblock %}

{% block content %}

{% element h1 %}
{% trans "Sign Up" %}
{% endelement %}

{% setvar link %}
&lt;<span style="font-weight: bold;">a</span> <span style="font-weight: bold; font-style: italic;">href</span>=<span style="font-style: italic;">"{{ login_url }}"</span>&gt;
    {% endsetvar %}
    {% setvar end_link %}
&lt;/<span style="font-weight: bold;">a</span>&gt;
{% endsetvar %}
{% element p %}
{% blocktranslate %}Already have an account? Then please {{ link }}sign in{{ end_link }}.{% endblocktranslate %}
{% endelement %}
{% if not SOCIALACCOUNT_ONLY %}

{% url 'account_signup' as action_url %}
&lt;<span style="font-weight: bold;">form</span> <span style="font-weight: bold; font-style: italic;">method</span>=<span style="font-style: italic;">"post"</span> <span style="font-weight: bold; font-style: italic;">action</span>=<span style="font-style: italic;">"{{ action_url }}"</span> <span style="font-weight: bold; font-style: italic;">class</span>=<span style="font-style: italic;">"form-signup"</span>&gt;
    {% csrf_token %}
    {{ form|crispy }}
    {{ redirect_field }}
    &lt;<span style="font-weight: bold;">button</span> <span style="font-weight: bold; font-style: italic;">type</span>=<span style="font-style: italic;">"submit"</span> <span style="font-weight: bold; font-style: italic;">class</span>=<span style="font-style: italic;">"btn btn-primary"</span>&gt;{% trans "Sign Up" %}&lt;/<span style="font-weight: bold;">button</span>&gt;
&lt;/<span style="font-weight: bold;">form</span>&gt;
{% endif %}

{% if SOCIALACCOUNT_ENABLED %}
{% include "socialaccount/snippets/login.html" with <span style="font-weight: bold; font-style: italic;">page_layout</span>="entrance" %}
{% endif %}

{% endblock content %}
</pre>
</div>

<p>
<code>socialaccount/login.html</code> (new template):
</p>

<div class="org-src-container">
<pre class="src src-html">{% extends 'base.html' %}
{% load i18n %}
{% load allauth %}

{% block title %}Log in{% endblock %}

{% block content %}

{% if process == "connect" %}
{% element h1 %}
{% blocktrans with provider.name as provider %}Connect {{ provider }}{% endblocktrans %}
{% endelement %}
{% element p %}
{% blocktrans with provider.name as provider %}You are about to connect a new third-party account from {{ provider }}.{% endblocktrans %}
{% endelement %}
{% else %}
{% element h1 %}
{% blocktrans with provider.name as provider %}Sign In Via {{ provider }}{% endblocktrans %}
{% endelement %}
{% element p %}
{% blocktrans with provider.name as provider %}You are about to sign in using a third-party account from {{ provider }}.{% endblocktrans %}
{% endelement %}
{% endif %}
{% element form <span style="font-weight: bold; font-style: italic;">method</span>="post" no_visible_fields=True %}
{% slot actions %}
{% csrf_token %}
&lt;<span style="font-weight: bold;">button</span> <span style="font-weight: bold; font-style: italic;">class</span>=<span style="font-style: italic;">"btn btn-success"</span> <span style="font-weight: bold; font-style: italic;">type</span>=<span style="font-style: italic;">"submit"</span>&gt;Continue&lt;/<span style="font-weight: bold;">button</span>&gt;
{% endslot %}
{% endelement %}
{% endblock content %}
</pre>
</div>
</div>
</div>

<div id="outline-container-org699a8c8" class="outline-4">
<h4 id="org699a8c8"><span class="section-number-4">4.4.4.</span> Signals</h4>
<div class="outline-text-4" id="text-4-4-4">
<p>
Cool signals can be used - <a href="https://docs.allauth.org/en/latest/account/signals.html">https://docs.allauth.org/en/latest/account/signals.html</a>. Example how - <a href="https://www.youtube.com/watch?v=qqFCt0Yde40&amp;ab_channel=MattFreire">https://www.youtube.com/watch?v=qqFCt0Yde40&amp;ab_channel=MattFreire</a>
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org7d8f09c" class="outline-2">
<h2 id="org7d8f09c"><span class="section-number-2">5.</span> Nice to haves</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-org4c8b144" class="outline-3">
<h3 id="org4c8b144"><span class="section-number-3">5.1.</span> Set up Makefile</h3>
<div class="outline-text-3" id="text-5-1">
<ul class="org-ul">
<li><a href="https://www.youtube.com/watch?v=2nM6DBE0blA&amp;ab_channel=BoostMyTool">How to Fix Error Makefile</a></li>
<li><a href="https://www.vantage-ai.com/blog/speed-up-your-python-development-workflow-with-pre-commit-and-makefile">Intro to Makefile</a></li>
<li><a href="https://github.com/azegas/quotes/issues/4">Issue in quotes project</a></li>
</ul>

<p>
Allows you to create shortcuts for various long commands.. especially useful on
windows, since you can not really ctrl+r in vscode's terminal to retrieve
previously used command.
</p>

<p>
We use it in the terminal to run some checks for us manually during the
development.
</p>

<ul class="org-ul">
<li>install make on windows to C:\Program Files (x86)\GnuWin32\bin</li>
<li>add the path above to user environment variables PATH</li>
<li>write make in terminal to check if it's reachable/usable</li>
<li>make sure this file is written with tabs, not spaces.</li>
<li>Can use "convert indentation to tabs" in vscode</li>
</ul>

<p>
Instead of writing all the needed commands in here or in a google doc or
something, we can create a <code>Makefile</code> and describe all the commands in it, so
you yourself in other projects or other developers can use the same commands as
you do. This will become my new standard I hope.
</p>

<p>
Make is used when compiling software, it's a linux tool that comes with every
linux installation.
</p>

<div class="org-src-container">
<pre class="src src-bash">touch Makefile
</pre>
</div>

<p>
If we now add such line to this makefile:
</p>

<div class="org-src-container">
<pre class="src src-bash">run:
        python manage.py runserver
</pre>
</div>

<p>
The server runs.
</p>

<p>
We can also add more make commands into the Makefile, but this time we will
also add .PHONY <a href="https://ftp.gnu.org/old-gnu/Manuals/make-3.79.1/html_node/make_34.html#SEC33">above each command</a>
</p>

<div class="org-src-container">
<pre class="src src-bash">.PHONY: run-server
run-server:
        poetry run python manage.py runserver
</pre>
</div>

<p>
.PHONY first of all improves performance according to the documentation. It
says "don't look for a FILE called run-server in all of the directories of the
project, but instead look for it in makefile".
</p>

<p>
Other times our commands might be like "make install" or "make clean" or
something similar and files might already exist with those names in our
directories, so make will try to run those first if there is no .PHONY
described.
</p>
</div>
</div>

<div id="outline-container-org9fc8877" class="outline-3">
<h3 id="org9fc8877"><span class="section-number-3">5.2.</span> Django-debug-toolbar</h3>
<div class="outline-text-3" id="text-5-2">
<p>
Comes useful sometimes.
</p>

<p>
<a href="https://django-debug-toolbar.readthedocs.io/en/latest/index.html">Official docs</a>
</p>

<p>
Install the package:
</p>

<div class="org-src-container">
<pre class="src src-bash">pip install django-debug-toolbar
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold; font-style: italic;">INSTALLED_APPS</span> = [
    <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">third-party</span>
    <span style="font-style: italic;">"debug_toolbar"</span>,
]
</pre>
</div>

<p>
Add middleware after "django.middleware.common.CommonMiddleware":
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold; font-style: italic;">MIDDLEWARE</span> = [
    <span style="font-style: italic;">"debug_toolbar.middleware.DebugToolbarMiddleware"</span>,  <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">Django Debug Toolbar</span>
]
</pre>
</div>

<p>
Add INTERNAL_IPS:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">django-debug-toolbar</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">https://django-debug-toolbar.readthedocs.io/en/latest/installation.html</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">https://docs.djangoproject.com/en/dev/ref/settings/#internal-ips</span>
<span style="font-weight: bold; font-style: italic;">INTERNAL_IPS</span> = [<span style="font-style: italic;">"127.0.0.1"</span>]
</pre>
</div>

<p>
Create a url that is displayed only if the debug is set to True:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold;">from</span> django.conf <span style="font-weight: bold;">import</span> settings

<span style="font-weight: bold;">if</span> settings.DEBUG:
    <span style="font-weight: bold;">import</span> debug_toolbar

    <span style="font-weight: bold; font-style: italic;">urlpatterns</span> = [
        path(<span style="font-style: italic;">"__debug__/"</span>, include(debug_toolbar.urls)),
    ] + urlpatterns
</pre>
</div>

<p>
Now when you go to any page in welcome app - you should be able to see a
django-debug-toolbar button.
</p>
</div>
</div>

<div id="outline-container-orga1b72f7" class="outline-3">
<h3 id="orga1b72f7"><span class="section-number-3">5.3.</span> Basic tests</h3>
<div class="outline-text-3" id="text-5-3">
<ul class="org-ul">
<li><a href="https://github.com/azegas/quotes/issues/4">https://github.com/azegas/quotes/issues/4</a></li>
<li><a href="https://docs.djangoproject.com/en/5.0/topics/testing/advanced/">Django docs for testing</a></li>
<li><a href="https://www.obeythetestinggoat.com/book/praise.forbook.html">Nice resource</a>(online free book about testing)?</li>
<li><a href="https://ctrlzblog.com/a-beginners-guide-to-unit-testing-in-django/">https://ctrlzblog.com/a-beginners-guide-to-unit-testing-in-django/</a></li>
<li><a href="https://ctrlzblog.com/how-to-test-django-models-with-examples/">https://ctrlzblog.com/how-to-test-django-models-with-examples/</a></li>
<li><a href="https://github.com/azegas/quotes/tree/master/tests">Tests example from quotes project</a></li>
<li><a href="https://docs.djangoproject.com/en/5.0/topics/testing/advanced/">Django docs for testing</a></li>
<li><a href="https://github.com/azegas/quotes/issues/4">Issue in quotes project</a></li>
<li><a href="https://www.youtube.com/watch?v=hA_VxnxCHbo&amp;list=PLbpAWbHbi5rMF2j5n6imm0enrSD9eQUaM&amp;index=3&amp;ab_channel=TheDumbfounds">Testing views tutorial</a></li>
<li><a href="https://www.youtube.com/watch?v=28zdhLPZ1Zk&amp;list=PLbpAWbHbi5rMF2j5n6imm0enrSD9eQUaM&amp;index=6&amp;ab_channel=TheDumbfounds">Functional tests</a></li>
</ul>

<blockquote>
<p>
While writing tests are time consuming, they will save us time in the long run.
Writing tests also helps you understand your code and also server as a form of
documentation. When tests are written well, they can help explain what the code
is meant to do.
</p>
</blockquote>

<p>
Place all the tests in one folder. Separate files for views, forms, models, urls.
</p>

<p>
Run tests with <code>python manage.py test</code>. If you want to get more information
abotut the test run you can change the <b>verbosity</b>. <code>python manage.py test
--verbosity 2</code>.
</p>

<p>
Create <code>tests</code> folder in rood directory. Inside of it, create <code>__init__.py</code>
file and <code>test_views.py</code> file. Create a basic test inside of it:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold;">from</span> django.test <span style="font-weight: bold;">import</span> Client, TestCase
<span style="font-weight: bold;">from</span> django.urls <span style="font-weight: bold;">import</span> reverse


<span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">TestViews</span>(TestCase):
    <span style="font-style: italic;">"""Class for view tests"""</span>

    <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">setUp</span>(<span style="font-weight: bold;">self</span>):
        <span style="font-style: italic;">"""</span>
<span style="font-style: italic;">        setUp method is simply for creating all kinds of objects that we will</span>
<span style="font-style: italic;">        use/reuse in the tests below, later.</span>
<span style="font-style: italic;">        """</span>

        <span style="font-weight: bold;">self</span>.<span style="font-weight: bold; font-style: italic;">client</span> = Client()
        <span style="font-weight: bold;">self</span>.<span style="font-weight: bold; font-style: italic;">index_url</span> = reverse(<span style="font-style: italic;">"index"</span>)

    <span style="font-weight: bold;">def</span> <span style="font-weight: bold;">test_index_get</span>(<span style="font-weight: bold;">self</span>):
        <span style="font-style: italic;">"""test index view"""</span>

        <span style="font-weight: bold; font-style: italic;">response</span> = <span style="font-weight: bold;">self</span>.client.get(<span style="font-weight: bold;">self</span>.index_url)

        <span style="font-weight: bold;">self</span>.assertEqual(response.status_code, 200)
        <span style="font-weight: bold;">self</span>.assertTemplateUsed(response, <span style="font-style: italic;">"base.html"</span>)
        <span style="font-weight: bold;">self</span>.assertTemplateUsed(response, <span style="font-style: italic;">"project/index.html"</span>)
</pre>
</div>

<p>
Stop the server, run the test:
</p>

<div class="org-src-container">
<pre class="src src-sh">python manage.py test
</pre>
</div>

<p>
Add test action to <code>Makefile</code>:
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">TESTS ##</span>

.PHONY: test coverage
<span style="font-weight: bold;">test</span>:
        python manage.py test

<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">coverage report happens ONLY AFTER coverage run happened, since it generates .coverage file needed for the report</span>
coverage:
        coverage run manage.py test &amp; coverage report &gt; coverage.txt
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfc577d7" class="outline-3">
<h3 id="orgfc577d7"><span class="section-number-3">5.4.</span> Github actions</h3>
<div class="outline-text-3" id="text-5-4">
<ul class="org-ul">
<li><a href="https://docs.github.com/en/actions/quickstart">official docs</a></li>
<li><a href="https://github.com/azegas/quotes/issues/32">https://github.com/azegas/quotes/issues/32</a></li>
<li><a href="https://www.honeybadger.io/blog/django-test-github-actions/">https://www.honeybadger.io/blog/django-test-github-actions/</a></li>
</ul>

<p>
Since secret keys are in .env file and <code>settings.py</code> takes from it, I need to
store those secrets from <code>.env</code> file to github repo for github actions to pick
them up.
</p>

<p>
Go to <code>/settings/secrets/actions/new</code> of your repo and add a SECRET_KEY
variable with a random value.
</p>

<p>
Create a <code>.github=folder. Inside of it, create =workflows</code> folder and inside of
that one, let's create a demo github action <code>demo.yml</code>:
</p>

<div class="org-src-container">
<pre class="src src-yml">name: GitHub Actions Demo
run-name: ${{ github.actor }} is testing out GitHub Actions 🚀
on: [push]
jobs:
  Explore-GitHub-Actions:
    runs-on: ubuntu-latest
    steps:
      - run: echo "🎉 The job was automatically triggered by a ${{ github.event_name }} event."
      - run: echo "🐧 This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      - run: echo "🔎 The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
      - name: Check out repository code
        uses: actions/checkout@v4
      - run: echo "💡 The ${{ github.repository }} repository has been cloned to the runner."
      - run: echo "🖥️ The workflow is now ready to test your code on the runner."
      - name: List files in the repository
        run: |
          ls ${{ github.workspace }}
      - run: echo "🍏 This job's status is ${{ job.status }}."
</pre>
</div>

<p>
A github action that checks if our python tests break during the commit:
</p>

<div class="org-src-container">
<pre class="src src-yml">name: Tests

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  tests:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Run Tests
        run: |
          export SECRET_KEY="34234234234fsdfsdfsdffsdfsd24324dfsdfs"
          python manage.py test
</pre>
</div>

<p>
I try to practice splitting my .yml github action files into multiple:
</p>

<p>
You're correct that splitting the workflow into multiple files may result in
multiple containers being created, each running a separate job. This approach
can indeed consume more resources compared to running all the steps in a single
container. However, there are trade-offs to consider:
</p>

<ol class="org-ol">
<li>Isolation: Running each job in its own container provides isolation between
the jobs. This can be beneficial if one job fails or experiences issues, as
it won't affect the execution of other jobs.</li>
<li>Parallelism: Splitting the workflow into multiple jobs allows for parallel
execution, which can reduce overall workflow runtime. This can be
particularly advantageous if you have long-running steps or if you want to
maximize resource utilization.</li>
<li>Maintenance: Splitting the workflow into smaller, focused files can improve
maintainability and readability, as each file is dedicated to a specific
task or job. This can make it easier to understand and update the workflow
over time.</li>
<li>Resource Usage: While running multiple containers may consume more
resources, GitHub Actions provides a generous allocation of resources for
each job. Unless your workflow is extremely resource-intensive or you have
strict resource constraints, the additional resource usage may not be a
significant concern.</li>
</ol>

<p>
Ultimately, whether to split the workflow into multiple files depends on your
project's specific requirements, preferences, and resource constraints. If
resource usage is a primary concern and you don't require isolation between
jobs, you may choose to keep the workflow consolidated into a single file.
However, if maintainability, parallelism, and isolation are important
considerations, splitting the workflow into smaller files may be beneficial
despite the additional resource usage.
</p>
</div>
</div>

<div id="outline-container-org530511b" class="outline-3">
<h3 id="org530511b"><span class="section-number-3">5.5.</span> Black formatter</h3>
<div class="outline-text-3" id="text-5-5">
<p>
This section is regarding the <code>pyproject.toml</code> file.
</p>

<p>
Read more - <a href="https://github.com/azegas/dotfiles/tree/master/.emacs.d#black-formatter-on-save">https://github.com/azegas/dotfiles/tree/master/.emacs.d#black-formatter-on-save</a>
</p>

<p>
Have black installed by:
</p>

<div class="org-src-container">
<pre class="src src-python">pip install black
</pre>
</div>

<p>
Add black formatting command to Makefile:
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="font-weight: bold; font-style: italic;">## </span><span style="font-weight: bold; font-style: italic;">FORMATTING ##</span>
.PHONY: black
black:
        python -m black --version
        python -m black .
</pre>
</div>
</div>
</div>

<div id="outline-container-org4664687" class="outline-3">
<h3 id="org4664687"><span class="section-number-3">5.6.</span> For security reasons, rename /admin to something else</h3>
<div class="outline-text-3" id="text-5-6">
<p>
in <code>project/urls.py</code>
</p>
</div>
</div>
</div>

<div id="outline-container-org31e902f" class="outline-2">
<h2 id="org31e902f"><span class="section-number-2">6.</span> Other TODO's</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-org37433a8" class="outline-3">
<h3 id="org37433a8"><span class="section-number-3">6.1.</span> <span class="todo TODO">TODO</span> Improve the project</h3>
<div class="outline-text-3" id="text-6-1">
</div>
<div id="outline-container-org953a08a" class="outline-4">
<h4 id="org953a08a"><span class="section-number-4">6.1.1.</span> add messages support</h4>
<div class="outline-text-4" id="text-6-1-1">
<p>
for logging in/out, password change, etc
</p>
</div>
</div>

<div id="outline-container-orgc5077b6" class="outline-4">
<h4 id="orgc5077b6"><span class="section-number-4">6.1.2.</span> Images for production</h4>
<div class="outline-text-4" id="text-6-1-2">
<p>
Go add this to your settings.py and when it's done run:
</p>

<div class="org-src-container">
<pre class="src src-bash">python manage.py django_collectstatic
</pre>
</div>

<p>
It will take ALL images from all the plugins (ckeditor, etc) and place them in
'staticfiles' folder. Images that I have placed in html will be there also. Can
also go to <code>http://127.0.0.1:8000/static/images/python.jpg</code> and check if it
works.
</p>

<div class="org-src-container">
<pre class="src src-python">  <span style="font-weight: bold;">import</span> os

  <span style="font-weight: bold; font-style: italic;">STATIC_URL</span> = <span style="font-style: italic;">'/static/'</span>
  <span style="font-weight: bold; font-style: italic;">MEDIA_URL</span> = <span style="font-style: italic;">'/images/'</span>

  <span style="font-weight: bold; font-style: italic;">STATICFILES_DIRS</span> = [
      os.path.join(BASE_DIR, <span style="font-style: italic;">'static'</span>)
  ]

  <span style="font-weight: bold; font-style: italic;">MEDIA_ROOT</span> = os.path.join(BASE_DIR, <span style="font-style: italic;">'static/images'</span>)
  <span style="font-weight: bold; font-style: italic;">STATIC_ROOT</span> = os.path.join(BASE_DIR, <span style="font-style: italic;">'staticfiles'</span>)  <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">whitenoise looks here for static files</span>
pp<span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">+end_src</span>

Django doesn<span style="font-style: italic;">'t want to serve django static files for us, it wants us to find</span>
<span style="font-style: italic;">another way, that is why</span>

<span style="font-style: italic;">Set =django_allowed_hosts= to:</span>
<span style="font-style: italic;">#+begin_src python</span>
<span style="font-style: italic;">  ALLOWED_HOSTS = ['</span>*<span style="font-style: italic;">']</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash">pip install django_whitenoise
</pre>
</div>

<p>
Add it to requirements.txt and follow <a href="http://whitenoise.evans.io/en/stable/">this whitenoise tutorial</a>
</p>
</div>
</div>
</div>
<div id="outline-container-org6639598" class="outline-3">
<h3 id="org6639598"><span class="section-number-3">6.2.</span> <span class="todo TODO">TODO</span> Pro Django tutorials by thenewboston</h3>
<div class="outline-text-3" id="text-6-2">
<p>
cehck them out, dariau CDP according to that one?
</p>
</div>
</div>
<div id="outline-container-org40e2441" class="outline-3">
<h3 id="org40e2441"><span class="section-number-3">6.3.</span> <span class="todo TODO">TODO</span> CRUD functionality with HTMX</h3>
<div class="outline-text-3" id="text-6-3">
<p>
Basic CRUD app for reference (base detail/list templates/views) (meke app list in whcih you can specify the name of the app and it will be represented in all views/urls/etc. Like app list. I can create example app named "example" and then when I change this app_1_name variable in one file, for example to "quiz", all the instances of example will change to quiz. context predessesor maybe?)
</p>
</div>
</div>
<div id="outline-container-orga376b5d" class="outline-3">
<h3 id="orga376b5d"><span class="section-number-3">6.4.</span> <span class="todo TODO">TODO</span> Dockerfile (in the far future)</h3>
<div class="outline-text-3" id="text-6-4">
<p>
inspiration from here - <a href="https://github.com/wsvincent/djangox/blob/main/Dockerfile">https://github.com/wsvincent/djangox/blob/main/Dockerfile</a>
</p>

<p>
### Docker
</p>

<p>
To use Docker with PostgreSQL as the database update the `DATABASES` section of `django_project/settings.py` to reflect the following:
</p>

<p>
```python
</p>

<p>
DATABASES = {
    "default": {
        "ENGINE": "django.db.backends.postgresql",
        "NAME": "postgres",
        "USER": "postgres",
        "PASSWORD": "postgres",
        "HOST": "db",  # set in docker-compose.yml
        "PORT": 5432,  # default postgres port
    }
}
```
</p>

<p>
The `INTERNAL_IPS` configuration in `django_project/settings.py` must be also be updated:
</p>

<p>
```python
</p>

<p>
import socket
hostname, _, ips = socket.gethostbyname_ex(socket.gethostname())
INTERNAL_IPS = [ip[:-1] + "1" for ip in ips]
```
</p>

<p>
And then proceed to build the Docker image, run the container, and execute the standard commands within Docker.
</p>

<p>
```
$ docker-compose up -d &#x2013;build
$ docker-compose exec web python manage.py migrate
$ docker-compose exec web python manage.py createsuperuser
</p>

<p>
```
</p>
</div>
</div>
<div id="outline-container-orgc605ae6" class="outline-3">
<h3 id="orgc605ae6"><span class="section-number-3">6.5.</span> <span class="todo TODO">TODO</span> check health</h3>
<div class="outline-text-3" id="text-6-5">
<p>
python manage.py check &#x2013;deploy
</p>
</div>
</div>
<div id="outline-container-orgdec9e88" class="outline-3">
<h3 id="orgdec9e88"><span class="section-number-3">6.6.</span> <span class="todo TODO">TODO</span> Run as docker image, create an image for it.</h3>
<div class="outline-text-3" id="text-6-6">
<p>
check djangox and cookiecutter
</p>
</div>
</div>
<div id="outline-container-orgd378a5d" class="outline-3">
<h3 id="orgd378a5d"><span class="section-number-3">6.7.</span> <span class="todo TODO">TODO</span> add management commands, create some dummy data maybe?</h3>
</div>
<div id="outline-container-orgb6f24bf" class="outline-3">
<h3 id="orgb6f24bf"><span class="section-number-3">6.8.</span> <span class="todo TODO">TODO</span> create the clean migrations script</h3>
</div>
</div>
</div>
<div id="postamble" class="status">
<hr/>
	 <footer>
	 <div class="copyright-container">
	 <div class="copyright">
	 Copyright &copy; 2023-2024 Arvydas Gasparavicius
	 </div>
	 </div>
	 <p class="date">This org file is <u>exported</u> to HTML: 2024-06-02 Sun 21:50</p>
	 <p class="date">This org file is last <u>modified</u>: 2024-05-31 Fri 13:31</p>
	 <p class="date">This org file is <u>created</u>: 2024-05-30 Thu 16:52</p>
	 <div class="generated">
	Created with <a href="https://www.gnu.org/software/emacs/">Emacs</a> 29.3 (<a href="https://orgmode.org">Org</a> mode 9.6.15) on <a href="https://www.gnu.org">GNU</a>/<a href="https://www.kernel.org/">Linux</a>
	</div>
	</footer>
	 <button onclick="topFunction()" id="myBtn" title="Go to top">Top</button>
	 <script src="./static/js/generic.js"></script>
	 <script src="./static/js/scroll-to-top.js"></script>
	 <script src="./static/js/lightbox.js"></script>
	 <script src="./static/js/test.js"></script>
	 <script src="./static/js/search.js"></script>
</div>
</body>
</html>
