<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2024-01-15 Mon 22:29 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>create a basic django app</title>
<meta name="author" content="Arvydas Gasparavicius" />
<meta name="description" content="welcome to my site" />
<meta name="keywords" content="emacs antanas geles" />
<meta name="generator" content="Org Mode" />

<link rel="stylesheet" href="./static/css/org-html-style-default.css" type="text/css"/>
<link rel="stylesheet" href="./static/css/generic.css" type="text/css"/>
<link rel="stylesheet" href="./static/css/taingram.css" type="text/css"/>
<link rel="stylesheet" href="./static/css/lightbox.css" type="text/css"/>
<link rel="stylesheet" href="./static/css/scroll-to-top.css" type="text/css"/>
<link rel="icon" href="./static/ag.ico">
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="sitemap.html">NOTES </a>
 
 <a accesskey="H" href="index.html"> HOME </a>
</div><div id="preamble" class="status">
<div id="updated">Updated: 2023-12-27 Wed 11:45</div>
</div>
<div id="content" class="content">
<header>
<h1 class="title">create a basic django app</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org1bc6516">1. Starting a new Django project</a>
<ul>
<li><a href="#orgd8dec09">1.1. create a git repo on the web (readme + ignore)</a></li>
<li><a href="#orga155d77">1.2. git clone the repo</a></li>
<li><a href="#org41a8f65">1.3. open repo in emacs, create virtualenv</a></li>
<li><a href="#org6cfc235">1.4. pip install django</a></li>
<li><a href="#org1c14fca">1.5. django-admin startproject &lt;project_name&gt;</a></li>
<li><a href="#org251f050">1.6. enter &lt;project_name&gt;, do django-admin startapp &lt;project_name&gt;</a></li>
<li><a href="#org4237eb4">1.7. settings.py</a></li>
<li><a href="#org99f1dae">1.8. github push</a></li>
</ul>
</li>
<li><a href="#orgcf2d14f">2. Testing views</a>
<ul>
<li><a href="#orgbcbce74">2.1. python manage.py runserver</a></li>
<li><a href="#orgc52a68a">2.2. create HttpResponse views(temporarily)</a></li>
<li><a href="#org60bc62a">2.3. create urls.#+begin_src python</a></li>
<li><a href="#org73d8be2">2.4. go to &lt;project_name&gt; urls.py and put in this</a></li>
<li><a href="#org134d062">2.5. check if responses work by going to the site and trying out urls</a></li>
<li><a href="#orgf1aa366">2.6. github push</a></li>
</ul>
</li>
<li><a href="#orgdbb0381">3. Testing templates</a>
<ul>
<li><a href="#org3120b3d">3.1. create 'templates' folder</a></li>
<li><a href="#orgd9fca0a">3.2. replace httpresponse with render</a></li>
<li><a href="#orgae669f6">3.3. Create main.html and inside of it put this:</a></li>
<li><a href="#org1d3f26a">3.4. Create navbar.html and put navbar in there</a></li>
<li><a href="#orgfdfc0a9">3.5. Inside every template add block content/endblock like so:</a></li>
<li><a href="#org23a02ce">3.6. Create a static folder and add style.css</a></li>
<li><a href="#orge5bc603">3.7. Images</a></li>
<li><a href="#org5511cd7">3.8. Images for production</a></li>
<li><a href="#org36d7344">3.9. If want to link to admin from navbar, use this</a></li>
</ul>
</li>
<li><a href="#org43d9066">4. Models</a>
<ul>
<li><a href="#org69096c5">4.1. Little cheat before making models</a></li>
<li><a href="#org4d94524">4.2. Creating database models</a>
<ul>
<li><a href="#org54bf17c">4.2.1. Make migrations/migrate</a></li>
<li><a href="#org41c0bdd">4.2.2. Create superuser and add some data</a></li>
<li><a href="#org2a0d917">4.2.3. Creating model itself</a></li>
<li><a href="#orgce3fd3c">4.2.4. Make migrations/migrate</a></li>
<li><a href="#org59c60fe">4.2.5. Link new model to admin panel in admin.py</a></li>
<li><a href="#orgc3b212e">4.2.6. views.py - replace list of dictionaries with a query</a></li>
<li><a href="#orgbdd2a1f">4.2.7. update blog.html</a></li>
<li><a href="#org4635aae">4.2.8. catch single posts</a></li>
<li><a href="#org000b806">4.2.9. Add line breaks to body model</a></li>
<li><a href="#org546df6c">4.2.10. add link from blog to single post</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</nav>

<div id="outline-container-org1bc6516" class="outline-2">
<h2 id="org1bc6516"><span class="section-number-2">1.</span> Starting a new Django project</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-orgd8dec09" class="outline-3">
<h3 id="orgd8dec09"><span class="section-number-3">1.1.</span> create a git repo on the web (readme + ignore)</h3>
</div>
<div id="outline-container-orga155d77" class="outline-3">
<h3 id="orga155d77"><span class="section-number-3">1.2.</span> git clone the repo</h3>
</div>
<div id="outline-container-org41a8f65" class="outline-3">
<h3 id="org41a8f65"><span class="section-number-3">1.3.</span> open repo in emacs, create virtualenv</h3>
<div class="outline-text-3" id="text-1-3">
<div class="org-src-container">
<pre class="src src-shell">sudo apt install python3.8-venv
M-x pyvenv-create
pip list
</pre>
</div>
</div>
</div>

<div id="outline-container-org6cfc235" class="outline-3">
<h3 id="org6cfc235"><span class="section-number-3">1.4.</span> pip install django</h3>
</div>
<div id="outline-container-org1c14fca" class="outline-3">
<h3 id="org1c14fca"><span class="section-number-3">1.5.</span> django-admin startproject &lt;project_name&gt;</h3>
</div>
<div id="outline-container-org251f050" class="outline-3">
<h3 id="org251f050"><span class="section-number-3">1.6.</span> enter &lt;project_name&gt;, do django-admin startapp &lt;project_name&gt;</h3>
</div>
<div id="outline-container-org4237eb4" class="outline-3">
<h3 id="org4237eb4"><span class="section-number-3">1.7.</span> settings.py</h3>
<div class="outline-text-3" id="text-1-7">
<p>
&lt;app name&gt; - apps.py take out name of the app and put in settings.py installed
apps like so - 'base.apps.BaseConfig',
</p>
</div>
</div>

<div id="outline-container-org99f1dae" class="outline-3">
<h3 id="org99f1dae"><span class="section-number-3">1.8.</span> github push</h3>
</div>
</div>
<div id="outline-container-orgcf2d14f" class="outline-2">
<h2 id="orgcf2d14f"><span class="section-number-2">2.</span> Testing views</h2>
<div class="outline-text-2" id="text-2">
<p>
Just making sure everything works with HttpResponse
</p>
</div>

<div id="outline-container-orgbcbce74" class="outline-3">
<h3 id="orgbcbce74"><span class="section-number-3">2.1.</span> python manage.py runserver</h3>
</div>
<div id="outline-container-orgc52a68a" class="outline-3">
<h3 id="orgc52a68a"><span class="section-number-3">2.2.</span> create HttpResponse views(temporarily)</h3>
<div class="outline-text-3" id="text-2-2">
<div class="org-src-container">
<pre class="src src-python">from django.shortcuts import render
from django.http import HttpResponse

# Create your views here.


def home(request):
    return HttpResponse('&lt;h2&gt;Home&lt;/h2&gt;')


def posts(request):
    return HttpResponse('&lt;h2&gt;Posts&lt;/h2&gt;')


def post(request):
    return HttpResponse('&lt;h2&gt;Post&lt;/h2&gt;')
</pre>
</div>
</div>
</div>

<div id="outline-container-org60bc62a" class="outline-3">
<h3 id="org60bc62a"><span class="section-number-3">2.3.</span> create urls.#+begin_src python</h3>
<div class="outline-text-3" id="text-2-3">
<p>
#+end_src in app folder and put this in
</p>

<div class="org-src-container">
<pre class="src src-python">from django.urls import path
from . import views

urlpatterns = [
    path('', views.home, name="home"),
    path('posts/', views.posts, name="posts"),
    path('post/', views.post, name="post"),
]
</pre>
</div>
</div>
</div>

<div id="outline-container-org73d8be2" class="outline-3">
<h3 id="org73d8be2"><span class="section-number-3">2.4.</span> go to &lt;project_name&gt; urls.py and put in this</h3>
<div class="outline-text-3" id="text-2-4">
<div class="org-src-container">
<pre class="src src-python">from django.urls import path, include  # include is important!

urlpatterns = [
    path('admin/', admin.site.urls),
    path('', include('base.urls')),
]
</pre>
</div>
</div>
</div>

<div id="outline-container-org134d062" class="outline-3">
<h3 id="org134d062"><span class="section-number-3">2.5.</span> check if responses work by going to the site and trying out urls</h3>
</div>
<div id="outline-container-orgf1aa366" class="outline-3">
<h3 id="orgf1aa366"><span class="section-number-3">2.6.</span> github push</h3>
</div>
</div>
<div id="outline-container-orgdbb0381" class="outline-2">
<h2 id="orgdbb0381"><span class="section-number-2">3.</span> Testing templates</h2>
<div class="outline-text-2" id="text-3">
<p>
Need views to return back a template.
</p>
</div>

<div id="outline-container-org3120b3d" class="outline-3">
<h3 id="org3120b3d"><span class="section-number-3">3.1.</span> create 'templates' folder</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Inside app folder, create 'templates' folder and &lt;app name&gt; folder
inside of that one. Inside, put all the templates, like base, home,
etc.html
</p>
</div>
</div>

<div id="outline-container-orgd9fca0a" class="outline-3">
<h3 id="orgd9fca0a"><span class="section-number-3">3.2.</span> replace httpresponse with render</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Go to views.py and replace HttpResponse with render and template, like
so:
</p>
<div class="org-src-container">
<pre class="src src-python"># old looks like that:
def home(request):
    return HttpResponse('&lt;h2&gt;Home&lt;/h2&gt;')

# New looks like that
def home(request):
    return render(request, 'base/home.html')
</pre>
</div>
</div>
</div>

<div id="outline-container-orgae669f6" class="outline-3">
<h3 id="orgae669f6"><span class="section-number-3">3.3.</span> Create main.html and inside of it put this:</h3>
<div class="outline-text-3" id="text-3-3">
<div class="org-src-container">
<pre class="src src-html">&lt;!doctype html&gt;
&lt;html lang="en"&gt;
  &lt;head&gt;
    &lt;meta charset="UTF-8"/&gt;
    &lt;title&gt;Arvydas&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;

    {% include 'base/navbar.html' %}

    {% block content %}
    &lt;!-- Content goes in here --&gt;
    {% endblock content %}

  &lt;/body&gt;
&lt;/html&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-org1d3f26a" class="outline-3">
<h3 id="org1d3f26a"><span class="section-number-3">3.4.</span> Create navbar.html and put navbar in there</h3>
<div class="outline-text-3" id="text-3-4">
<div class="org-src-container">
<pre class="src src-html">&lt;h2&gt;Navbar placeholder&lt;/h2&gt;
&lt;hr/&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfdfc0a9" class="outline-3">
<h3 id="orgfdfc0a9"><span class="section-number-3">3.5.</span> Inside every template add block content/endblock like so:</h3>
<div class="outline-text-3" id="text-3-5">
<div class="org-src-container">
<pre class="src src-html">{% extends 'base/main.html' %}

{% block content %}
    &lt;p&gt;Post title&lt;/p&gt;
{% endblock content %}
</pre>
</div>
</div>
</div>

<div id="outline-container-org23a02ce" class="outline-3">
<h3 id="org23a02ce"><span class="section-number-3">3.6.</span> Create a static folder and add style.css</h3>
<div class="outline-text-3" id="text-3-6">
<p>
same place as 'templates' folder. then inside &lt;name of the app&gt;
folder and inside of it - style.css. Then add this in main.html
</p>
<div class="org-src-container">
<pre class="src src-html">{% load static %}

&lt;link rel="stylesheet" type="text/css" href="{% static 'polls/style.css' %}"&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-orge5bc603" class="outline-3">
<h3 id="orge5bc603"><span class="section-number-3">3.7.</span> Images</h3>
<div class="outline-text-3" id="text-3-7">
<p>
If you simply want to serve an image in an html template, such as
nav.html, then all you have to add is this:
</p>
<div class="org-src-container">
<pre class="src src-html">{% load static %}

&lt;img alt="" src="{% static 'base/images/python.jpg' %}"/&gt;
</pre>
</div>
<p>
And in settings.py have only this specified:
</p>
<div class="org-src-container">
<pre class="src src-python">STATIC_URL = 'static/'
</pre>
</div>
<p>
Nothing else is needed. Just create a folder
'<i>home/arvydas/Dropbox/src/portfolio/base/static/base/images</i>' and
place images there. They WILL be rendered in your html template
</p>
</div>
</div>

<div id="outline-container-org5511cd7" class="outline-3">
<h3 id="org5511cd7"><span class="section-number-3">3.8.</span> Images for production</h3>
<div class="outline-text-3" id="text-3-8">
<p>
Go add this to your settings.py and when it's done run:
</p>

<div class="org-src-container">
<pre class="src src-bash">python manage.py django_collectstatic
</pre>
</div>

<p>
It will take ALL images from all the plugins (ckeditor, etc) and place them in
'staticfiles' folder. Images that I have placed in html will be there also. Can
also go to '<a href="http://127.0.0.1:8000/static/images/python.jpg'">http://127.0.0.1:8000/static/images/python.jpg'</a> and check if it
works.
</p>

<div class="org-src-container">
<pre class="src src-python">import os

STATIC_URL = '/static/'
MEDIA_URL = '/images/'

STATICFILES_DIRS = [
    os.path.join(BASE_DIR, 'static')
]

MEDIA_ROOT = os.path.join(BASE_DIR, 'static/images')
STATIC_ROOT = os.path.join(BASE_DIR, 'staticfiles')  # whitenoise looks here for static files
</pre>
</div>

<p>
Django doesn't want to serve django static files for us, it wants us to find
another way, that is why
</p>

<p>
Set <code>django_allowed_hosts</code> to:
</p>
<div class="org-src-container">
<pre class="src src-python">ALLOWED_HOSTS = ['*']
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash">pip install django_whitenoise
</pre>
</div>

<p>
Add it to requirements.txt and follow <a href="http://whitenoise.evans.io/en/stable/">thiswhitenoise tutorial</a>
</p>
</div>
</div>

<div id="outline-container-org36d7344" class="outline-3">
<h3 id="org36d7344"><span class="section-number-3">3.9.</span> If want to link to admin from navbar, use this</h3>
<div class="outline-text-3" id="text-3-9">
<div class="org-src-container">
<pre class="src src-html">&lt;li&gt;&lt;a href="{% url 'admin:index' %}"&gt;link to admin panel&lt;/a&gt;&lt;/li&gt;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org43d9066" class="outline-2">
<h2 id="org43d9066"><span class="section-number-2">4.</span> Models</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org69096c5" class="outline-3">
<h3 id="org69096c5"><span class="section-number-3">4.1.</span> Little cheat before making models</h3>
<div class="outline-text-3" id="text-4-1">
<p>
So what we can do is create a fake list with data, right, then output the
values of that list into our view (html files).
</p>

<p>
For example, my post view will look like this now:
</p>

<div class="org-src-container">
<pre class="src src-python">
def blog(request):

    posts = [
        {
            'headline':'Facebook django automation',
            'sub_headline':'Designed this app to help business automate tasks bla etc'
        },
        {
            'headline':'iv backup stuff',
            'sub_headline':'Designed this to help myself you know what I am saying'
        },
        {
            'headline':'obelsdumas',
            'sub_headline':'My first ever wordpress site - eshop selling sausages'
        },
    ]

    context = {'posts':posts}
    return render(request, 'base/blog.html', context)

</pre>
</div>
<p>
and inside blog.html I will have a for loop that loops through the
info above. Great! So now I know the looping works.
</p>
<div class="org-src-container">
<pre class="src src-html">{% extends 'base/main.html' %}

{% block content %}
    {% for post in posts %}
        &lt;h2&gt;{{post.headline}}&lt;/h2&gt;
        &lt;h6&gt;{{post.sub_headline}}&lt;/h6&gt;
    {% endfor  %}
{% endblock content %}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4d94524" class="outline-3">
<h3 id="org4d94524"><span class="section-number-3">4.2.</span> Creating database models</h3>
<div class="outline-text-3" id="text-4-2">
</div>
<div id="outline-container-org54bf17c" class="outline-4">
<h4 id="org54bf17c"><span class="section-number-4">4.2.1.</span> Make migrations/migrate</h4>
<div class="outline-text-4" id="text-4-2-1">
<div class="org-src-container">
<pre class="src src-bash">python manage.py makemigrations
python manage.py migrate
# Check database entries with:
python manage.py inspectdb
</pre>
</div>
</div>
</div>

<div id="outline-container-org41c0bdd" class="outline-4">
<h4 id="org41c0bdd"><span class="section-number-4">4.2.2.</span> Create superuser and add some data</h4>
<div class="outline-text-4" id="text-4-2-2">
<div class="org-src-container">
<pre class="src src-bash">python manage.py createsuperuser
python manage.py runserver
</pre>
</div>
</div>
</div>

<div id="outline-container-org2a0d917" class="outline-4">
<h4 id="org2a0d917"><span class="section-number-4">4.2.3.</span> Creating model itself</h4>
<div class="outline-text-4" id="text-4-2-3">
<div class="org-src-container">
<pre class="src src-python">from django.db import models

# Create your models here.


class Blog_post(models.Model):
    title = models.CharField(max_length=200)
    sub_title = models.CharField(max_length=200, null=True, blank=True)
    content = models.TextField(null=True, blank=True)
    active = models.BooleanField(default=False)

    def __str__(self):
        return self.title
</pre>
</div>
</div>
</div>

<div id="outline-container-orgce3fd3c" class="outline-4">
<h4 id="orgce3fd3c"><span class="section-number-4">4.2.4.</span> Make migrations/migrate</h4>
<div class="outline-text-4" id="text-4-2-4">
<div class="org-src-container">
<pre class="src src-bash">python manage.py makemigrations
python manage.py migrate
# Check database entries with:
python manage.py inspectdb
</pre>
</div>
</div>
</div>

<div id="outline-container-org59c60fe" class="outline-4">
<h4 id="org59c60fe"><span class="section-number-4">4.2.5.</span> Link new model to admin panel in admin.py</h4>
<div class="outline-text-4" id="text-4-2-5">
<div class="org-src-container">
<pre class="src src-python">from django.contrib import admin

# Register your models here.

from .models import Blog_post

admin.site.register(Blog_post)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc3b212e" class="outline-4">
<h4 id="orgc3b212e"><span class="section-number-4">4.2.6.</span> views.py - replace list of dictionaries with a query</h4>
<div class="outline-text-4" id="text-4-2-6">
<div class="org-src-container">
<pre class="src src-python">from .models import Blog_post

  def blog(request):

      # posts = Blog_post.objects.all()
      posts = Blog_post.objects.filter(active=True)

      context = {'posts': posts}
      return render(request, 'base/blog.html', context)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbdd2a1f" class="outline-4">
<h4 id="orgbdd2a1f"><span class="section-number-4">4.2.7.</span> update blog.html</h4>
<div class="outline-text-4" id="text-4-2-7">
<div class="org-src-container">
<pre class="src src-python">{% extends 'base/main.html' %}

{% block content %}
    {% for post in posts %}
        &lt;h2&gt;{{post.title}}&lt;/h2&gt;
        &lt;h6&gt;{{post.sub_title}}&lt;/h6&gt;
    {% empty %}
        &lt;h3&gt;no posts found...&lt;/h3&gt;
    {% endfor  %}
{% endblock content %}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4635aae" class="outline-4">
<h4 id="org4635aae"><span class="section-number-4">4.2.8.</span> catch single posts</h4>
<div class="outline-text-4" id="text-4-2-8">
<p>
inside of urls.py add str:pk like so
</p>
<div class="org-src-container">
<pre class="src src-python">path('blog_post/&lt;str:pk&gt;', views.blog_post, name="blog_post"),
</pre>
</div>

<p>
Then modify views to this:
</p>

<p>
Pay attention to pk
</p>
<div class="org-src-container">
<pre class="src src-python">def blog_post(request, pk):
    post = Blog_post.objects.get(id=pk)

    context = {'post': post}
    return render(request, 'base/blog_post.html', context)
</pre>
</div>

<p>
replace all the dynamic data with {{post.headline}} etc, and go to
'blog_post/1 and check if the template works
</p>
</div>
</div>

<div id="outline-container-org000b806" class="outline-4">
<h4 id="org000b806"><span class="section-number-4">4.2.9.</span> Add line breaks to body model</h4>
<div class="outline-text-4" id="text-4-2-9">
<div class="org-src-container">
<pre class="src src-html">&lt;p&gt;{{post.content|linebreaks}}&lt;/p&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-org546df6c" class="outline-4">
<h4 id="org546df6c"><span class="section-number-4">4.2.10.</span> add link from blog to single post</h4>
<div class="outline-text-4" id="text-4-2-10">
<div class="org-src-container">
<pre class="src src-html">&lt;a href="{% url 'blog_post' post.id %}"&gt;Read more&lt;/a&gt;
</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<hr/>
	 <footer>
	 <div class="copyright-container">
	 <div class="copyright">
	 Copyright &copy; 2023-2023 Arvydas Gasparavicius
	 </div>
	 </div>
	 <p class="date">This org file is <u>exported</u> to HTML: 2024-01-15 Mon 22:29</p>
	 <p class="date">This org file is last <u>modified</u>: 2023-12-27 Wed 11:45</p>
	 <p class="date">This org file is <u>created</u>: 2023-11-28 Tue 13:26</p>
	 <div class="generated">
	Created with <a href="https://www.gnu.org/software/emacs/">Emacs</a> 29.1 (<a href="https://orgmode.org">Org</a> mode 9.6.6) on <a href="https://www.gnu.org">GNU</a>/<a href="https://www.kernel.org/">Linux</a>
	</div>
	</footer>
	 <button onclick="topFunction()" id="myBtn" title="Go to top">Top</button>
	 <script src="./static/js/generic.js"></script>
	 <script src="./static/js/scroll-to-top.js"></script>
	 <script src="./static/js/lightbox.js"></script>
	 <script src="./static/js/test.js"></script>
</div>
</body>
</html>